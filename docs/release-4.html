<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Nutils 4 Eliche - The Nutils Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">The Nutils Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/evalf/nutils-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-4-eliche"><a class="header" href="#nutils-4-eliche">Nutils 4 Eliche</a></h1>
<p>Nutils 4 was released on June 11th, 2019 and saw one point release for fixes
and backports. The most recent and final version in this series is Nutils 4.1
was released on August 28th, 2018.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v4.1.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v4.1/">API Reference</a></li>
</ul>
<h2 id="whats-new"><a class="header" href="#whats-new">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-3.html">Nutils 3 Dragon
Beard</a>.</p>
<h3 id="spline-basis-continuity-argument"><a class="header" href="#spline-basis-continuity-argument">Spline basis continuity argument</a></h3>
<p>In addition to the <code>knotmultiplicities</code> argument to define the
continuity of basis function on structured topologies, the
<code>nutils.topology.Topology.basis</code> method now supports the
<code>continuity</code> argument to define the global continuity of basis
functions. With negative numbers counting backwards from the
<code>degree</code>, the default value of <code>-1</code> corresponds to a knot
multiplicity of 1.</p>
<h3 id="eval-arguments"><a class="header" href="#eval-arguments">Eval arguments</a></h3>
<p>Functions of type <code>nutils.function.Evaluable</code> can receive
arguments in addition to element and points by depending on instances
of <code>nutils.function.Argument</code> and having their values specified
via <code>nutils.sample.Sample.eval</code>:</p>
<pre><code class="language-python">f = geom.dot(function.Argument('myarg', shape=geom.shape))
f = 'x_i ?myarg_i' @ ns # equivalent operation in namespace
topo.sample('uniform', 1).eval(f, myarg=numpy.ones(geom.shape))
</code></pre>
<h3 id="the-d-operator"><a class="header" href="#the-d-operator">The d:-operator</a></h3>
<p>Namespace expression syntax now includes the <code>d:</code> Jacobian operator,
allowing one to write <code>'d:x' @ ns</code> instead of <code>function.J(ns.x)</code>.
Since including the Jacobian in the integrand is preferred over
specifying it separately, the <code>geometry</code> argument of
<code>nutils.topology.Topology.integrate</code> is deprecated:</p>
<pre><code class="language-python">topo.integrate(ns.f, geometry=ns.x) # deprecated
topo.integrate(ns.f * function.J(ns.x)) # was and remains valid
topo.integrate('f d:x' @ ns) # new namespace syntax
</code></pre>
<h3 id="truncated-hierarchical-bsplines"><a class="header" href="#truncated-hierarchical-bsplines">Truncated hierarchical bsplines</a></h3>
<p>Hierarchically refined topologies now support basis truncation, which
reduces the supports of individual basis functions while maintaining
the spanned space. To select between truncated and non-truncated the
basis type must be prefixed with 'th-' or 'h-', respectively. A
non-prefixed basis type falls back on the default implementation that
fails on all types but discont:</p>
<pre><code class="language-python">htopo.basis('spline', degree=2) # no longer valid
htopo.basis('h-spline', degree=2) # new syntax for original basis
htopo.basis('th-spline', degree=2) # new syntax for truncated basis
htopo.basis('discont', degree=2) # still valid
</code></pre>
<h3 id="transparent-function-cache"><a class="header" href="#transparent-function-cache">Transparent function cache</a></h3>
<p>The <code>nutils.cache</code> module provides a memoizing function decorator
<code>nutils.cache.function</code> which reads return values from cache in
case a set of function arguments has been seen before. It is similar
in function to Python's <code>functools.lru_cache</code>, except that the cache
is maintained on disk and <code>nutils.types.nutils_hash</code> is used to
compare arguments, which means that arguments need not be Python
hashable. The mechanism is activated via <code>nutils.cache.enable</code>:</p>
<pre><code class="language-python">@cache.function
def f(x):
  return x * 2

with cache.enable():
  f(10)
</code></pre>
<p>If <code>nutils.cli.run</code> is used then the cache can also be enabled
via the new <code>--cache</code> command line argument. With many internal
Nutils functions already decorated, including all methods in the
<code>nutils.solver</code> module, transparent caching is available out of
the box with no further action required.</p>
<h3 id="new-module-types"><a class="header" href="#new-module-types">New module: types</a></h3>
<p>The new <code>nutils.types</code> module unifies and extends components
relating to object types. The following preexisting objects have been
moved to the new location:</p>
<ul>
<li><code>util.enforcetypes</code> → <code>types.apply_annotations</code></li>
<li><code>util.frozendict</code> → <code>types.frozendict</code></li>
<li><code>numeric.const</code> → <code>types.frozenarray</code></li>
</ul>
<h3 id="mkl-matrix-pardiso-solver"><a class="header" href="#mkl-matrix-pardiso-solver">MKL matrix, Pardiso solver</a></h3>
<p>The new <code>MKL</code> backend generates matrices that are powered by Intel's Math
Kernel Library, which notably includes the reputable Pardiso solver. This
requires <code>libmkl</code> to be installed, which is conveniently available through
pip:</p>
<pre><code class="language-sh">pip install mkl
</code></pre>
<p>When <code>nutils.cli.run</code> is used the new matrix type is selected
automatically if it is available, or manually using <code>--matrix=MKL</code>.</p>
<h3 id="nonlinear-minimization"><a class="header" href="#nonlinear-minimization">Nonlinear minimization</a></h3>
<p>For problems that adhere to an energy structure, the new solver method
<code>nutils.solver.minimize</code> provides an alternative mechanism that
exploits this structure to robustly find the energy minimum:</p>
<pre><code class="language-python">res = sqr.derivative('dofs')
solver.newton('dofs', res, ...)
solver.minimize('dofs', sqr, ...) # equivalent
</code></pre>
<h3 id="data-packing"><a class="header" href="#data-packing">Data packing</a></h3>
<p>Two new methods, <code>nutils.numeric.pack</code> and its inverse
<code>nutils.numeric.unpack</code>, provide lossy compression to floating
point data. Primarily useful for regression tests, the convenience
method <code>numeric.assert_allclose64</code> combines data packing with zlib
compression and base64 encoding for inclusion in Python codes.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="release-5.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="release-3.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="release-5.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="release-3.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
