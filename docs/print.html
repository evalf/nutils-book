<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Nutils Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">The Nutils Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/evalf/nutils-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="about-nutils"><a class="header" href="#about-nutils">About Nutils</a></h1>
<p>Nutils is a Free and <a href="https://github.com/evalf/nutils/">Open Source</a> Python
programming library for Finite Element Method computations, developed by
<a href="https://evalf.com/">Evalf</a> and distributed under the permissive MIT license.
Key features are a readable, math centric syntax, an object oriented design,
strict separation of topology and geometry, and high level function
manipulations with support for automatic differentiation.</p>
<p>Nutils provides the tools required to construct a typical simulation workflow
in just a few lines of Python code, while at the same time leaving full
flexibility to build novel workflows or interact with third party tools. With
native support for Isogeometric Analysis (IGA), the Finite Cell method (FCM),
multi-physics, mixed methods, and hierarchical refinement, Nutils forms an
excellent platform for numerical science. Efficient under-the-hood
vectorization and built-in parallellisation provide for an effortless
transition from academic research projects to full scale, real world
applications.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="how-to-read-this-book"><a class="header" href="#how-to-read-this-book">How to Read This Book</a></h1>
<p>Since Nutils is a library for the development of numerical simulations, this
book assumes that the reader is familiar with differential calculus, Galerkin
methods, and the Finite Element Method. If this is not the case, chances are
that Nutils is not the tool they are looking for.</p>
<p>First time users who are eager to get their feet wet will want to begin with
the <a href="start.html">getting started guide</a> and build a functioning Poisson solver in
three easy steps, no questions asked. Following this, beginners are strongly
advised to follow the hands on <a href="tutorial.html">tutorial</a> to gain an an in-depth
understanding of Nutils concepts and get familiar with the syntax.</p>
<p>Novices and advanced users alike may find interest in the <a href="install.html">installation
guide</a>, which ranges from basic <a href="install-nutils.html">installation
instructions</a> to tips and tricks for <a href="install-performance.html">optimizing the
installation</a>, instructions for running a <a href="install-containers.html">Docker style
container</a>, and suggestions for <a href="install-remote.html">computing
remotely</a>.</p>
<p>The <a href="release.html">release history</a> provides an overview of changes between
releases. This is the place to monitor for long term users who want to keep up
to date with the latest and greatest new features. The release pages also
provide links to the relevant API reference where all Nutils functions are
documented.</p>
<p>Anybody looking to build their own Nutils simulations are encouraged to browse
through the <a href="examples.html">example projects</a>. Most simulations will have
components in common with existing scripts, so a mix-and-match approach is a
good way to start building your own. In case questions do remain, the <a href="support.html">support
page</a> lists ways of getting in touch with developers.</p>
<p>Finally, the <a href="science.html">science</a> section provides an overview of
<a href="science-publications.html">publications</a> that use Nutils in their research.
Reproducing results from these articles is a great starting point for follow-up
research, as well as good scientific practice in its own right. Help others
do the same by <a href="science-citing.html">citing Nutils</a> in your own publications!</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>The following is a quick start guide to running your first Nutils simulation in
three simple steps. Afterward, be sure to read the <a href="install.html">installation
guide</a> for extra installation instructions, study the
<a href="tutorial.html">tutorial</a> to familiarize yourself with Nutils' concepts and
syntax, and explore the <a href="examples.html">examples</a> for inspiration.</p>
<h2 id="step-1-install-nutils-and-matplotlib"><a class="header" href="#step-1-install-nutils-and-matplotlib">Step 1: Install Nutils and Matplotlib</a></h2>
<p>With Python version 3.7 or newer installed, Nutils and Matplotlib can be
installed via the <a href="https://pypi.org/project/nutils/">Python Package Index</a>
using the pip package installer.
In a terminal window with an active <a href="https://docs.python.org/3/library/venv.html">Python virtual environment</a>:</p>
<pre><code class="language-sh">python -m pip install nutils matplotlib
</code></pre>
<p>Note that Nutils depends on Numpy, Treelog and Stringly, which means that these
modules are pulled in automatically if they were not installed prior. Though most
Nutils applications will require <a href="https://matplotlib.org/">Matplotlib</a> for
visualization, it is not a dependency for Nutils itself, and is therefore
installed explicitly.</p>
<h2 id="step-2-create-a-simulation-script"><a class="header" href="#step-2-create-a-simulation-script">Step 2: Create a simulation script</a></h2>
<p>Open a text editor and create a file <code>poisson.py</code> with the following contents:</p>
<pre><code class="language-python">from nutils import mesh, function, solver, export, cli

def main(nelems: int = 10, etype: str = 'square'):
    domain, x = mesh.unitsquare(nelems, etype)
    u = function.dotarg('udofs', domain.basis('std', degree=1))
    g = u.grad(x)
    J = function.J(x)
    cons = solver.optimize('udofs',
        domain.boundary.integral(u**2 * J, degree=2), droptol=1e-12)
    udofs = solver.optimize('udofs',
        domain.integral((g @ g / 2 - u) * J, degree=1), constrain=cons)
    bezier = domain.sample('bezier', 3)
    x, u = bezier.eval([x, u], arguments=dict(udofs=udofs))
    export.triplot('u.png', x, u, tri=bezier.tri, hull=bezier.hull)

cli.run(main)
</code></pre>
<p>Note that while we could make the script even shorter by avoiding the main
function and <code>cli.run</code>, the above structure is preferred as it automatically
sets up a logging environment, activates a matrix backend and handles command
line parsing.</p>
<h2 id="step-3-run-the-simulation"><a class="header" href="#step-3-run-the-simulation">Step 3: Run the simulation</a></h2>
<p>Back in the terminal, the simulation can now be started by running:</p>
<pre><code class="language-sh">python poisson.py
</code></pre>
<p>This should produce the following output:</p>
<pre><code>NUTILS 9.0 "Jook-Sing"
arguments &gt; nelems=10
arguments &gt; etype=square
solve_constraints &gt; optimizing for argument udofs (121) with drop tolerance 1e-12
solve_constraints &gt; residual norm: 0.0e+00
solve_constraints &gt; optimal value: 0.0e+00
solve_constraints &gt; constrained 40 degrees of freedom of udofs
solve &gt; optimizing for argument udofs (121) using direct method
solve &gt; residual norm: 6.5e-17
solve &gt; optimal value: -1.7e-02
u.png
log written to file:///home/myusername/public_html/poisson.py/log.html
</code></pre>
<p>If the terminal is reasonably modern (Windows users may want to install the new
<a href="https://aka.ms/windowsterminal">Windows Terminal</a>) then the messages are
coloured for extra clarity. The last line of the log shows the location of the
simultaneously generated html file that holds the same log, as well as a link
to the generated image.</p>
<p>To run the same simulation on a mesh that is finer and made up or triangles
instead of squares, arguments can be provided on the command line:</p>
<pre><code class="language-sh">python poisson.py nelems=20 etype=triangle
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>Nutils requires a working installation of Python 3.7 or higher. Many different
installers exist and there are no known issues with any of them. When in doubt
about which to use, a safe option is to go with the <a href="https://www.python.org/downloads/">official
installer</a>. From there on Nutils can be
installed following the steps below.</p>
<p>Depending on your system the Python executable may be installed as either
<code>python</code> or <code>python3</code>, or both, not to mention alternative implementations such
as <code>pypy</code> or <code>pyston</code>. In the following instructions, <code>python</code> is to be
replaced with the relevant executable name.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="installing-nutils"><a class="header" href="#installing-nutils">Installing Nutils</a></h1>
<p>Nutils is installed via Python's <a href="https://pip.pypa.io/en/stable/">Pip</a> package
installer, which most Python distributions install by default. In the following
instructions we assume that pip is run with sufficient privileges to install
modules system wide, or (more common) that a <a href="https://docs.python.org/3/library/venv.html">virtual
environment</a> is active for local
installation.</p>
<p>The following command installs the stable version of Nutils from the package
archive, along with its dependencies <a href="https://numpy.org/">Numpy</a>,
<a href="https://github.com/evalf/treelog">Treelog</a> and
<a href="https://github.com/evalf/stringly">Stringly</a>:</p>
<pre><code class="language-sh">python -m pip install nutils
</code></pre>
<p>To install the most recent development version we use Github's ability to
generate zip balls:</p>
<pre><code class="language-sh">python -m pip install https://github.com/evalf/nutils/archive/refs/heads/main.zip
</code></pre>
<p>Alternatively, if the <a href="https://git-scm.com/">Git</a> version control system is
installed, we can use pip's ability to interact with it directly to install the
same version as follows:</p>
<pre><code class="language-sh">python -m pip install git+https://github.com/evalf/nutils.git@main
</code></pre>
<p>This notation has the advantage that even a specific tag or commit (rather than
a branch name) can be installed directly by specifying it after the <code>@</code>.</p>
<p>Finally, if we do desire a checkout of the Nutils source code, for instance to
make changes to it, then we can instruct pip to install directly from the
location on disk:</p>
<pre><code class="language-sh">git clone https://github.com/evalf/nutils.git
cd nutils
python -m pip install .
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="installing-a-matrix-backend"><a class="header" href="#installing-a-matrix-backend">Installing a matrix backend</a></h1>
<p>Nutils currently supports three matrix backends: Numpy, Scipy and MKL. Since
Numpy is a primary dependency this backend is always available. Unfortunately
it is also the least performant of the three because of its inability to
exploit sparsity. It is therefore strongly recommended to install one of the
other two backends via the instructions below.</p>
<p>By default, Nutils automatically activates the best available matrix backend:
MKL, Scipy or Numpy, in that order. A consequence of this is that a faulty
installation may easily go unnoticed as Nutils will silently fall back on a
lesser backend. As such, to make sure that the installation was successful it
is recommended to force the backend at least once by setting the
<code>NUTILS_MATRIX</code> environment variable. In Linux:</p>
<pre><code class="language-sh">NUTILS_MATRIX=MKL python myscript.py
</code></pre>
<h2 id="scipy"><a class="header" href="#scipy">Scipy</a></h2>
<p>The Scipy matrix backend becomes available when <a href="https://www.scipy.org/">Scipy</a>
is installed, either using the platform's package manager or via pip:</p>
<pre><code class="language-sh">python -m pip install scipy
</code></pre>
<p>In addition to a sparse direct solver, the Scipy backend provides many
iterative solvers such as CG, CGS and GMRES, as well as preconditioners. The
direct solver can optionally be made more performant by additionally installing
the <code>scikit-umfpack</code> module.</p>
<h2 id="mkl"><a class="header" href="#mkl">MKL</a></h2>
<p>Intel's oneAPI Math Kernel Library provides the Pardiso sparse direct solver,
which is easily the most powerful direct solver that is currently supported. It
is installed via the <a href="https://software.intel.com/oneapi/onemkl">official
instructions</a>, or, if applicable, by
any of the steps below.</p>
<p>On a Debian based Linux system (such as Ubuntu) the libraries can be directly
installed via the package manager:</p>
<pre><code class="language-sh">sudo apt install libmkl-rt
</code></pre>
<p>For Fedora or Centos Linux, Intel maintains its own repository that can be
added with the following steps:</p>
<pre><code class="language-sh">sudo dnf config-manager --add-repo https://yum.repos.intel.com/mkl/setup/intel-mkl.repo
sudo rpm --import https://yum.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2019.PUB
sudo dnf install intel-mkl
sudo tee /etc/ld.so.conf.d/mkl.conf &lt;&lt; EOF &gt; /dev/null
/opt/intel/lib/intel64/
/opt/intel/mkl/lib/intel64/
EOF
sudo ldconfig -v
</code></pre>
<p>If it is impossible to install MKL system wide, for instance because of lacking
administrative powers, then an easy way of installing it with user privileges
is to use pip. Nutils will automatically load the libraries from pip's default
installation path.</p>
<pre><code class="language-sh">python -m pip install mkl
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="quality-of-life"><a class="header" href="#quality-of-life">Quality of Life</a></h1>
<p>Here we list some modules that are not direct requirements, but that can be
used in conjunction with Nutils to make life a little bit better.</p>
<h2 id="bottombar"><a class="header" href="#bottombar">BottomBar</a></h2>
<p><a href="https://pypi.org/project/bottombar/">BottomBar</a> is a context manager for
Python that prints a status line at the bottom of a terminal window. When it is
installed, <code>cli.run</code> automatically activates it to display the location of the
html log (rather than only logging it at the beginning and end of the
simulation) as well as runtime and (optionally) memory usage information.</p>
<pre><code class="language-sh">python -m pip install bottombar
</code></pre>
<h2 id="psutil"><a class="header" href="#psutil">Psutil</a></h2>
<p><a href="https://pypi.org/project/psutil/">Psutil</a> is a cross platform library for
retrieving information on the running process. If it is installed in
conjunction with bottombar, <code>cli.run</code> automatically adds an entry that shows
the current memory usage.</p>
<pre><code class="language-sh">python -m pip install psutil
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="improving-performance"><a class="header" href="#improving-performance">Improving performance</a></h1>
<p>While Nutils is not (yet) the fastest tool in its class, with some effort it is
possible to achieve sufficient performance to allow simulations of over a
million degrees of freedom. The matrix backend is the most important thing to
get right, but there are a few other factors that are worth considering.</p>
<h2 id="enable-parallel-processing"><a class="header" href="#enable-parallel-processing">Enable parallel processing</a></h2>
<p>On multi-core architectures, the most straightforward acceleration path
available is to use parallel assembly, activated using the <code>NUTILS_NPROCS</code>
environment variable. Both Linux and OS X both are supported. Unfortunately,
the feature is currently disabled on Windows as it does not support the <code>fork</code>
system call that is used by the current implementation.</p>
<p>On Windows, the easiest way to enjoy parallel speedup is to make use of the new
Windows Subsystem for Linux (WSL2), which is complete Linux environment running
on top of Windows. To install it simply select one of the many Linux
distributions from the Windows store, such as <a href="https://www.microsoft.com/store/apps/9n6svws3rx71">Ubuntu 20.04
LTS</a> or <a href="https://www.microsoft.com/store/apps/9MSVKQC78PK6">Debian
GNU/Linux</a>.</p>
<h2 id="disable-threads"><a class="header" href="#disable-threads">Disable threads</a></h2>
<p>Many Numpy installations default to using the openBLAS library to provide its
linear algebra routines, which supports multi-threading using the openMP
parallelization standard. While this is useful in general, it is in fact
detrimental in case Nutils is using parallel assembly, in which case the
numerical operations are best performed sequentially. This can be achieved by
setting the <code>OMP_NUM_THREADS</code> environment variable.</p>
<p>In Linux this can be done permanently by adding the following line to the
shell's configuration file. In Linux this is typically <code>~/.bashrc</code>:</p>
<pre><code class="language-sh">export OMP_NUM_THREADS=1
</code></pre>
<p>The downside to this approach is that multithreading is disabled for all
applications that use openBLAS, not just Nutils. Alternatively in Linux the
setting can be specified one-off in the form of a prefix:</p>
<pre><code class="language-sh">OMP_NUM_THREADS=1 NUTILS_NPROCS=8 python myscript.py
</code></pre>
<h2 id="consider-a-faster-interpreter"><a class="header" href="#consider-a-faster-interpreter">Consider a faster interpreter</a></h2>
<p>The most commonly used Python interpreter is without doubt the
<a href="https://github.com/python/cpython">CPython</a> reference implementation, but it
is not the only option. Before taking an application in production it may be
worth testing if <a href="https://www.python.org/download/alternatives">other
implementations</a> have useful
performance benefits.</p>
<p>One interpreter of note is <a href="https://www.pyston.org">Pyston</a>, which brings
just-in-time compilation enhancements that in a typical application can yield a
20% speed improvement. After Pyston is installed, Nutils and dependencies can
be installed as before simply replacing <code>python</code> by <code>pyston3</code>. As packages will
be installed from source some development libraries may need to be installed,
but what is missing can usually be inferred from the error messages.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="using-containers"><a class="header" href="#using-containers">Using Containers</a></h1>
<p>As an alternative to installing Nutils, it is possible to download a
preinstalled system image with all the above considerations taken care of.
Nutils provides <a href="https://opencontainers.org">OCI</a> compatible containers for all
releases, as well as the current developement version, which can be run using
tools such as <a href="https://www.docker.com">Docker</a> or <a href="https://podman.io">Podman</a>.
The images are hosted in <a href="https://github.com/evalf/nutils/pkgs/container/nutils">Github's container
repository</a>.</p>
<p>The container images include all the official <a href="examples.html">examples</a>. To run
one, add the name of the example and any additional arguments to the command
line. For example, you can run example <code>laplace</code> using the latest version of
Nutils with:</p>
<pre><code class="language-sh">docker run --rm -it ghcr.io/evalf/nutils:latest laplace
</code></pre>
<p>HTML log files are generated in the <code>/log</code> directory of the container. If you
want to store the log files in <code>/path/to/log</code> on the host, add <code>-v /path/to/log:/log</code> to the command line before the name of the image. Extending
the previous example:</p>
<pre><code class="language-sh">docker run --rm -it -v /path/to/log:/log ghcr.io/evalf/nutils:latest laplace
</code></pre>
<p>To run a Python script in this container, bind mount the directory containing
the script, including all files necessary to run the script, to <code>/app</code> in the
container and add the relative path to the script and any arguments to the
command line. For example, you can run <code>/path/to/myscript.py</code> with Docker
using:</p>
<pre><code class="language-sh">docker run --rm -it -v /path/to:/app:ro ghcr.io/evalf/nutils:latest myscript.py
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="remote-computing"><a class="header" href="#remote-computing">Remote Computing</a></h1>
<p>Computations beyond a certain size are usually moved to a remote computing
facility, typically accessed using tools such as <a href="https://en.wikipedia.org/wiki/Secure_Shell">Secure
Shell</a> or <a href="https://mosh.org">Mosh</a>,
combined with a terminal multiplexer such as <a href="https://www.gnu.org/software/screen/">GNU
Screen</a> or
<a href="https://github.com/tmux/tmux/wiki">Tmux</a>. In this scenario it is useful to
install a webserver for remote viewing of the html logs.</p>
<p>The standard <code>~/public_html</code> output directory is configured with the scenario
in mind, as the <a href="https://httpd.apache.org/">Apache</a> webserver uses this as the
default <a href="https://httpd.apache.org/docs/2.4/howto/public_html.html">user
directory</a>. As this
is disabled by default, the module needs to be enabled by editing the relevant
configuration file or, in Debian Linux, by using the <code>a2enmod</code> utility:</p>
<pre><code class="language-sh">sudo a2enmod userdir
</code></pre>
<p>Similar behaviour can be achieved with the <a href="https://www.nginx.com/">Nginx</a> by
configuring a location pattern in the appropriate server block:</p>
<pre><code>location ~ ^/~(.+?)(/.*)?$ {
  alias /home/$1/public_html$2;
}
</code></pre>
<p>Finally, the terminal output can be made to show the http address rather than
the local uri by setting the <code>NUTILS_OUTROOTURI</code> environment variable, e.g.:</p>
<pre><code>export NUTILS_OUTROOTURI="http://mydomain.tld/~myname/"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="tutorial"><a class="header" href="#tutorial">Tutorial</a></h1>
<p>In this tutorial we will explore Nutils' main building blocks by solving a
simple 1D Laplace problem. The tutorial assumes knowledge of the
<a href="https://www.python.org/">Python</a> programming language, as well as familiarity
with the third party modules <a href="https://numpy.org/">Numpy</a> and
<a href="https://matplotlib.org/">Matplotlib</a>. It also assumes knowledge of advanced
calculus, weak formulations, and the Finite Element Method, and makes heavy use
of <a href="https://en.wikipedia.org/wiki/Einstein_notation">Einstein notation</a>.</p>
<h2 id="whetting-your-appetite"><a class="header" href="#whetting-your-appetite">Whetting your Appetite</a></h2>
<p>The computation that we will work towards amounts to about 20 lines of Nutils
code, including visualization. The entire script is presented below, in
copy-pasteable form suitable for interactive exploration using for example
ipython. In the sections that follow we will go over these lines ones by one
and explain the relevant concepts involved.</p>
<pre><code class="language-python">from nutils import mesh, function, export, solver
from nutils.expression_v2 import Namespace
from matplotlib import pyplot
import numpy

topo, geom = mesh.rectilinear([numpy.linspace(0, 1, 5)])

ns = Namespace()
ns.x = geom
ns.define_for('x', gradient='∇', normal='n', jacobians=('dV', 'dS'))
ns.u = topo.field('u', btype='spline', degree=2)
ns.v = topo.field('v', btype='spline', degree=2)

sqr = topo.boundary['left'].integral('(u - 1)^2 dS' @ ns, degree=2)
cons = solver.System(sqr, trial='u').solve_constraints(droptol=1e-15)
# optimize &gt; constrained 1/5 dofs
# optimize &gt; optimum value 0.00e+00

res = topo.integral('(∇_k(v) ∇_k(u) + 2 v) dV' @ ns, degree=2)
res -= topo.boundary['right'].integral('v dS' @ ns, degree=2)
args = solver.System(res, trial='u', test='v').solve(constrain=cons)
# solve &gt; solving 4 dof system to machine precision using arnoldi solver
# solve &gt; solver returned with residual 9e-16±1e-15

def myplot(topo, geom, func, arguments={}):
    bezier = topo.sample('bezier', 9)
    x, fs = bezier.eval([geom, list(func) if func.ndim else [func]], arguments=arguments)
    fig, axs = pyplot.subplots(nrows=len(fs), sharex=True, squeeze=False)
    for (ax,), f in zip(axs, fs):
        export.triplot(ax, x, f, tri=bezier.tri, hull=bezier.hull)

myplot(topo, ns.x, ns.u, args)
</code></pre>
<p><img src="tutorial-fig1.svg" alt="output" /></p>
<p>You are encouraged to execute this code at least once before reading on, as the
code snippets that follow may assume certain products to be present in the
namespace. In particular the <code>plot_line</code> function is used heavily in the
ensuing sections.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="a-little-bit-of-theory"><a class="header" href="#a-little-bit-of-theory">A Little Bit of Theory</a></h1>
<p>We will introduce fundamental Nutils concepts based on the 1D homogeneous
Laplace problem,</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span></p>
<p>with boundary conditions <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>. Even though the solution
to this problem is easily found to be <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>, the example serves
to introduce many key concepts in the Nutils paradigm, concepts that can then
be applied to solve a wide class of physics problems.</p>
<h2 id="weak-form"><a class="header" href="#weak-form">Weak Form</a></h2>
<p>A key step to solving a problem using the Finite Element Method is to cast it
into weak form.</p>
<p>Let <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Ω</span></span></span></span> be the unit line <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> with boundaries <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">left</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>
and <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">right</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>, and let <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">Ω</span><span class="mclose">)</span></span></span></span> be a suitable function
space such that any <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">Ω</span><span class="mclose">)</span></span></span></span> satisfies <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> in <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">left</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. The Laplace problem is solved uniquely by the element <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">Ω</span><span class="mclose">)</span></span></span></span> for which <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> for all test functions <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">Ω</span><span class="mclose">)</span></span></span></span>, with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> the bilinear functional</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">Ω</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.475em;vertical-align:-1.115em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord text mtight"><span class="mord mtight">right</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.115em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">.</span></span></span></span></span></p>
<h2 id="discrete-solution"><a class="header" href="#discrete-solution">Discrete Solution</a></h2>
<p>The final step before turning to code is to make the problem discrete.</p>
<p>To restrict ourselves to a finite dimensional subspace we adopt a set of Finite
Element basis functions <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">Ω</span><span class="mclose">)</span></span></span></span>. In this space, the Finite Element
solution is established by solving the linear system of equations <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>, with residual vector <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>,
and discrete solution</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p>
<p>Note that discretization inevitably implies approximation, i.e. <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span>
in general. In this case, however, we choose <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> to be the
space of piecewise linears, which contains the exact solution. We therefore
expect our Finite Element solution to be exact.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="topology-vs-geometry"><a class="header" href="#topology-vs-geometry">Topology vs Geometry</a></h1>
<p>Rather than having a single concept of what is typically referred to as the
'mesh', Nutils maintains a strict separation of <em>topology</em> and <em>geometry</em>. The
<code>nutils.topology.Topology</code> represents a collection of elements and
inter-element connectivity, along with recipes for creating bases. It has no
(public) notion of position.  The geometry takes the <code>nutils.topology.Topology</code>
and positions it in space.  This separation makes it possible to define
multiple geometries belonging to a single <code>nutils.topology.Topology</code>, a feature
that is useful for example in certain Lagrangian formulations.</p>
<p>While not having mesh objects, Nutils does have a <code>nutils.mesh</code> module, which
hosts functions that return tuples of topology and geometry. Nutils provides
two builtin mesh generators: <code>nutils.mesh.rectilinear</code>, a generator for
structured topologies (i.e. tensor products of one or more one-dimensional
topologies), and <code>nutils.mesh.unitsquare</code>, a unit square mesh generator with
square or triangular elements or a mixture of both.  The latter is mostly
useful for testing. In addition to generators, Nutils also provides the
<code>nutils.mesh.gmsh</code> importer for <a href="http://gmsh.info/">gmsh</a>-generated meshes.</p>
<p>The structured mesh generator takes as its first argument a list of element
vertices per dimension. A one-dimensional topology with four elements of equal
size between 0 and 1 is generated by</p>
<pre><code class="language-python">mesh.rectilinear([[0, 0.25, 0.5, 0.75, 1.0]])
# (StructuredTopology&lt;4&gt;, Array&lt;1&gt;)
</code></pre>
<p>Alternatively we could have used <code>numpy.linspace</code> to generate a sequence of
equidistant vertices, and unpack the resulting tuple:</p>
<pre><code class="language-python">topo, geom = mesh.rectilinear([numpy.linspace(0, 1, 5)])
</code></pre>
<p>We will use this topology and geometry throughout the remainder of this
tutorial.</p>
<p>Note that the argument is a list of length one: this outer sequence lists the
dimensions, the inner the vertices per dimension. To generate a two-dimensional
topology, simply add a second list of vertices to the outer list.  For example,
an equidistant topology with four by eight elements with a unit square geometry
is generated by</p>
<pre><code class="language-python">mesh.rectilinear([numpy.linspace(0, 1, 5), numpy.linspace(0, 1, 9)])
# (StructuredTopology&lt;4x8&gt;, Array&lt;2&gt;)
</code></pre>
<p>Any topology defines a boundary via the <code>nutils.topology.Topology.boundary</code>
attribute. Optionally, a topology can offer subtopologies via the getitem
operator. The rectilinear mesh generator automatically defines 'left' and
'right' boundary groups for the first dimension, making the left boundary
accessible as:</p>
<pre><code class="language-python">topo.boundary['left']
# StructuredTopology&lt;&gt;
</code></pre>
<p>Optionally, a topology can be made periodic in one or more dimensions by
passing a list of dimension indices to be periodic via the keyword argument
<code>periodic</code>.  For example, to make the second dimension of the above
two-dimensional mesh periodic, add <code>periodic=[1]</code>:</p>
<pre><code class="language-python">mesh.rectilinear([numpy.linspace(0, 1, 5), numpy.linspace(0, 1, 9)], periodic=[1])
# (StructuredTopology&lt;4x8p&gt;, Array&lt;2&gt;)
</code></pre>
<p>Note that in this case the boundary topology, though still available, is empty.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="bases"><a class="header" href="#bases">Bases</a></h1>
<p>In Nutils, a <em>basis</em> is a vector-valued function object that evaluates, in any
given point <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span></span></span></span> on the topology, to the full array of basis function
values <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span class="mclose">)</span></span></span></span>. It must be pointed out that
Nutils will in practice operate only on the basis functions that are locally
non-zero, a key optimization in Finite Element computations. But as a concept,
it helps to think of a basis as evaluating always to the full array.</p>
<p>Several <code>nutils.topology.Topology</code> objects support creating bases via the
<code>Topology.basis()</code> method. A <code>nutils.topology.StructuredTopology</code>, as generated
by <code>nutils.mesh.rectilinear</code>, can create a spline basis with arbitrary degree
and arbitrary continuity. The following generates a degree one spline basis on
our previously created unit line topology <code>topo</code>:</p>
<pre><code class="language-python">basis = topo.basis('spline', degree=1)
</code></pre>
<p>The five basis functions are</p>
<pre><code class="language-python">myplot(topo, geom, basis)
</code></pre>
<p><img src="tutorial-bases-fig1.svg" alt="output" /></p>
<p>We will use this basis throughout the following sections.</p>
<p>Change the <code>degree</code> argument to <code>2</code> for a quadratic spline basis:</p>
<pre><code class="language-python">myplot(topo, geom, topo.basis('spline', degree=2))
</code></pre>
<p><img src="tutorial-bases-fig2.svg" alt="output" /></p>
<p>By default the continuity of the spline functions at element edges is the
degree minus one.  To change this, pass the desired continuity via keyword
argument <code>continuity</code>.  For example, a quadratic spline basis with <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span>
continuity is generated with</p>
<pre><code class="language-python">myplot(topo, geom, topo.basis('spline', degree=2, continuity=0))
</code></pre>
<p><img src="tutorial-bases-fig3.svg" alt="output" /></p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span> continuous spline bases can also be generated by the <code>'std'</code> basis:</p>
<pre><code class="language-python">myplot(topo, geom, topo.basis('std', degree=2))
</code></pre>
<p><img src="tutorial-bases-fig4.svg" alt="output" /></p>
<p>The <code>'std'</code> basis is supported by topologies with square and/or triangular
elements without hanging nodes.</p>
<p>Discontinuous basis functions are generated using the <code>'discont'</code> type, e.g.</p>
<pre><code class="language-python">myplot(topo, geom, topo.basis('discont', degree=2))
</code></pre>
<p><img src="tutorial-bases-fig5.svg" alt="output" /></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="functions"><a class="header" href="#functions">Functions</a></h1>
<p>A <em>function</em> in Nutils is a mapping from a topology onto an n-dimensional
array, and comes in the form of a functions: <code>nutils.function.Array</code> object. It
is not to be confused with Python's own function objects, which operate on the
space of general Python objects. Two examples of Nutils functions have already
made the scene: the geometry <code>geom</code>, as returned by <code>nutils.mesh.rectilinear</code>,
and the bases generated by <code>Topology.basis()</code>. Though seemingly different,
these two constructs are members of the same class and in fact fully
interoperable.</p>
<p>The <code>nutils.function.Array</code> functions behave very much like <code>numpy.ndarray</code>
objects: the functions have a <code>nutils.function.Array.shape</code>,
<code>nutils.function.Array.ndim</code> and a <code>nutils.function.Array.dtype</code>:</p>
<pre><code class="language-python">geom.shape
# (1,)
basis.shape
# (5,)
geom.ndim
# 1
geom.dtype
# &lt;class 'float'&gt;
</code></pre>
<p>The functions support numpy-style indexing.  For example, to get the first
element of the geometry <code>geom</code> you can write <code>geom[0]</code> and to select the first
two basis functions you can write</p>
<pre><code class="language-python">myplot(topo, geom, basis[:2])
</code></pre>
<p><img src="tutorial-functions-fig1.svg" alt="output" /></p>
<p>The usual unary and binary operators are available:</p>
<pre><code class="language-python">myplot(topo, geom, geom[0]*(1-geom[0])/2)
</code></pre>
<p><img src="tutorial-functions-fig2.svg" alt="output" /></p>
<p>Several trigonometric functions are defined in the <code>nutils.function</code> module.
An example with a sine function:</p>
<pre><code class="language-python">myplot(topo, geom, numpy.sin(2*geom[0]*numpy.pi))
</code></pre>
<p><img src="tutorial-functions-fig3.svg" alt="output" /></p>
<p>The dot product is available via the '@' operator. To contract the basis with an
arbitrary coefficient vector:</p>
<pre><code class="language-python">myplot(topo, geom, basis @ [1,2,0,5,4])
</code></pre>
<p><img src="tutorial-functions-fig4.svg" alt="output" /></p>
<p>Recalling the definition of the <a href="tutorial-theory.html#discrete-solution">discrete
solution</a>, the above is precisely the way
to evaluate the resulting function. What remains now is to establish the
coefficients for which this function solves the Laplace problem.</p>
<h2 id="arguments"><a class="header" href="#arguments">Arguments</a></h2>
<p>A discrete model is often written in terms of (vectors of) unknowns. In Nutils,
unknowns are represented by functions of type <code>nutils.function.Argument</code>, which
have a known shape but undefined contents. Every argument has a name to
identify it, which cannot be reused for different arguments in the same
expression.</p>
<p>The <a href="tutorial-theory.html#discrete-solution">discrete solution</a> can now be
written as an inner product with a basis, with the vector of unknowns
<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> represented by the argument <code>'u'</code>:</p>
<pre><code class="language-python">from nutils.function import Argument
u = basis @ Argument('u', basis.shape)
</code></pre>
<p>Since it is slightly tedious to create an argument that has a matching shape to
an existing basis, the function module provides a convenience function that
does the work for you.</p>
<pre><code class="language-python">from nutils.function import field
u = field('u', basis)
</code></pre>
<p>Moreover, as it is rarely necessary to manipulate a basis directly, the
topology object adds a layer of convenience that creates the basis, contracts
it with an argument, and returns only the result. This is the form that we will
most often encounter:</p>
<pre><code class="language-python">u = topo.field('u', btype='spline', degree=1)
</code></pre>
<p>If a function depends on one or more arguments, then their values must be
specified at evaluation time. However we cannot demonstrate that yet for the
discrete solution defined here as it still requires a specification of the
relevant topological points. This will be the subject of
<a href="tutorial-integrals.html">integrals</a>.</p>
<p>What we can do is take derivatives with respect to arguments. The derivative
appends the argument shape to that of the original function. Here we take the
derivative of u, the function, with respect to 'u', the argument, to
effectively extract the basis:</p>
<pre><code class="language-python">basis = u.derivative('u')
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="namespace"><a class="header" href="#namespace">Namespace</a></h1>
<p>Nutils functions behave entirely like Numpy arrays, and can be manipulated as
such, using a combination of operators, object methods, and methods found in
the <code>nutils.function</code> module. Though powerful, the resulting code is often
lengthy, littered with colons and brackets, and hard to read. <em>Namespaces</em>
provide an alternative, cleaner syntax for a prominent subset of array
manipulations.</p>
<p>A <code>nutils.expression_v2.Namespace</code> is a collection of <code>nutils.function.Array</code>
functions.  An empty <code>nutils.expression_v2.Namespace</code> is created as follows:</p>
<pre><code class="language-python">ns = Namespace()
</code></pre>
<p>New entries are added to a <code>nutils.expression_v2.Namespace</code> by assigning an
<code>nutils.function.Array</code> to an attribute.  For example, the geometry
<code>geom</code> is assigned to <code>ns.x</code> via</p>
<pre><code class="language-python">ns.x = geom
</code></pre>
<p>You can now use <code>ns.x</code> where you would use <code>geom</code>. Usually you will want to add
the gradient, normal and jacobian of this geometry to the namespace as well.
This can be done by calling <code>nutils.expression_v2.Namespace.define_for</code> with
the name of the geometry (as present in the namespace) followed by the names or
symbols you choose to represent the desired features as optional keyword
arguments:</p>
<pre><code class="language-python">ns.define_for('x', gradient='∇', normal='n', jacobians=('dV', 'dS'))
</code></pre>
<p>The discrete solution is again added through a simple assignment:</p>
<pre><code class="language-python">ns.u = topo.field('u', btype='spline', degree=1)
</code></pre>
<p>It is also possible to assign numbers and <code>numpy.ndarray</code> objects:</p>
<pre><code class="language-python">ns.a = 1
ns.b = 2
ns.c = numpy.array([1,2])
ns.A = numpy.array([[1,2],[3,4]])
</code></pre>
<h2 id="expressions"><a class="header" href="#expressions">Expressions</a></h2>
<p>In addition to inserting ready objects, a namespace's real power lies in its
ability to be assigned string expressions. These expressions may reference any
<code>nutils.function.Array</code> function present in the
<code>nutils.expression_v2.Namespace</code>, and must explicitly name all array
dimensions, with the object of both aiding readibility and facilitating high
order tensor manipulations. A short explanation of the syntax follows; see
<code>nutils.expression_v2</code> for the complete documentation.</p>
<p>A <em>term</em> is written by joining variables with spaces, optionally preceeded by a
single number, e.g. <code>2 a b</code>.  A <em>fraction</em> is written as two terms joined by
<code>/</code>, e.g. <code>2 a / 3 b</code>, which is equivalent to <code>(2 a) / (3 b)</code>.  An <em>addition</em>
or <em>subtraction</em> is written as two terms joined by <code>+</code> or <code>-</code>, respectively,
e.g. <code>1 + a b - 2 b</code>.  <em>Exponentation</em> is written by two variables or numbers
joined by <code>^</code>, e.g. <code>a^2</code>.  Several trigonometric functions are available, e.g.
<code>0.5 sin(a)</code>.</p>
<p>Assigning an expression to the namespace is then done as follows.</p>
<pre><code class="language-python">ns.e = '2 a / 3 b'
ns.e = (2*ns.a) / (3*ns.b) # equivalent w/o expression
</code></pre>
<p>The resulting <code>ns.e</code> is an ordinary <code>nutils.function.Array</code>.  Note that the
variables used in the expression should exist in the namespace, not just as a
local variable:</p>
<pre><code class="language-python (skip)">localvar = 1
ns.f = '2 localvar'
# Traceback (most recent call last):
#   ...
# nutils.expression_v2.ExpressionSyntaxError: No such variable: `localvar`.
# 2 localvar
#   ^^^^^^^^
</code></pre>
<p>When using arrays in an expression all axes of the arrays should be labelled
with an index, e.g.  <code>2 c_i</code> and <code>c_i A_jk</code>.  Repeated indices are summed, e.g.
<code>A_ii</code> is the trace of <code>d</code> and <code>A_ij c_j</code> is the matrix-vector product of <code>d</code>
and <code>c</code>.  You can also insert a number, e.g. <code>c_0</code> is the first element of <code>c</code>.
All terms in an expression should have the same set of indices after summation,
e.g. it is an error to write <code>c_i + 1</code>.</p>
<p>When assigning an expression with remaining indices to the namespace, the
indices should be listed explicitly at the left hand side:</p>
<pre><code class="language-python">ns.f_i = '2 c_i'
ns.f = 2*ns.c # equivalent w/o expression
</code></pre>
<p>The order of the indices matter: the resulting <code>nutils.function.Array</code> will
have its axes ordered by the listed indices.  The following three statements
are equivalent:</p>
<pre><code class="language-python">ns.g_ijk = 'c_i A_jk'
ns.g_kji = 'c_k A_ji'
ns.g = ns.c[:,numpy.newaxis,numpy.newaxis]*ns.A[numpy.newaxis,:,:] # equivalent w/o expression
</code></pre>
<p>Function <code>∇</code>, introduced to the namespace with
<code>~nutils.expression_v2.Namespace.define_for</code> using geometry <code>ns.x</code>, returns the
gradient of a variable with respect <code>ns.x</code>, e.g. the gradient of the basis is
<code>∇_i(basis_n)</code>.  This works with expressions as well, e.g. <code>∇_i(2 basis_n + basis_n^2)</code> is the gradient of <code>2 basis_n + basis_n^2</code>.</p>
<h2 id="manual-evaluation"><a class="header" href="#manual-evaluation">Manual evaluation</a></h2>
<p>Sometimes it is useful to evaluate an expression to an
<code>nutils.function.Array</code> without inserting the result in the namespace.
This can be done using the <code>&lt;expression&gt; @ &lt;namespace&gt;</code> notation.  An example
with a scalar expression:</p>
<pre><code class="language-python">'2 a / 3 b' @ ns
# Array&lt;&gt;
(2*ns.a) / (3*ns.b) # equivalent w/o `... @ ns`
# Array&lt;&gt;
</code></pre>
<p>An example with a vector expression:</p>
<pre><code class="language-python">'2 c_i' @ ns
# Array&lt;2&gt;
2*ns.c # equivalent w/o `... @ ns`
# Array&lt;2&gt;
</code></pre>
<p>If an expression has more than one remaining index, the axes of the evaluated
array are ordered alphabetically:</p>
<pre><code class="language-python">'c_i A_jk' @ ns
# Array&lt;2,2,2&gt;
ns.c[:,numpy.newaxis,numpy.newaxis]*ns.A[numpy.newaxis,:,:] # equivalent w/o `... @ ns`
# Array&lt;2,2,2&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="integrals"><a class="header" href="#integrals">Integrals</a></h1>
<p>A central operation in any Finite Element application is to integrate a
function over a physical domain. In Nutils, integration starts with the
topology, in particular the <code>integral()</code> method.</p>
<p>The integral method takes a <code>nutils.function.Array</code> function as first argument
and the degree as keyword argument. The function should contain the Jacobian of
the geometry against which the function should be integrated, using either
<code>nutils.function.J</code> or <code>dV</code> in a namespace expression (assuming the jacobian
has been added to the namespace using <code>ns.define_for(..., jacobians=('dV', 'dS'))</code>). For example, the following integrates <code>1</code> against geometry <code>x</code>:</p>
<pre><code class="language-python">I = topo.integral('1 dV' @ ns, degree=0)
# Array&lt;&gt;
</code></pre>
<p>The resulting <code>nutils.function.Array</code> object is a representation of the
integral, as yet unevaluated. To compute the actual numbers, use the
<code>function.eval()</code> function:</p>
<pre><code class="language-python">function.eval(I)
# 1.0
</code></pre>
<p>Be careful with including the Jacobian in your integrands.  The following two
integrals are different:</p>
<pre><code class="language-python">function.eval(topo.integral('(1 + 1) dV' @ ns, degree=0))
# 2.0
function.eval(topo.integral('1 + 1 dV' @ ns, degree=0))
# 5.0
</code></pre>
<p>Like any other <code>nutils.function.Array</code>, the integrals can be added or
subtracted:</p>
<pre><code class="language-python">J = topo.integral('x_0 dV' @ ns, degree=1)
function.eval(I+J)
# 1.5
</code></pre>
<p>Recall that a topology boundary is also a <code>nutils.topology.Topology</code> object,
and hence it supports integration.  For example, to integrate the geometry <code>x</code>
over the entire boundary, write</p>
<pre><code class="language-python">function.eval(topo.boundary.integral('x_0 dS' @ ns, degree=1))
# 1.0
</code></pre>
<p>To limit the integral to the right boundary, write</p>
<pre><code class="language-python">function.eval(topo.boundary['right'].integral('x_0 dS' @ ns, degree=1))
# 1.0
</code></pre>
<p>Note that this boundary is simply a point and the integral a point evaluation.</p>
<h2 id="back-to-our-discrete-solution"><a class="header" href="#back-to-our-discrete-solution">Back to our discrete solution</a></h2>
<p>We observed earlier that we cannot evaluate our discrete solution because of
lacking a specification of topological points -- or in Nutils jargon: leaving a
<em>space</em> unbound. Integrals provide this information by defining the set of
quadrature points that the function will be evaluated in (followed by a
contraction with quadrature weights). This means we could aim to evaluate the
following function:</p>
<pre><code class="language-python">f = topo.integral('∇_k(u) ∇_k(u) dV' @ ns, degree=1)
</code></pre>
<p>However, to do so we do need to provide the weights for argument 'u'. We do
this as follows:</p>
<pre><code class="language-python">function.eval(f, arguments={'u': [1,2,0,5,4]})
</code></pre>
<p>Since integrals are <code>nutils.function.Array</code> objects, integrals involving
arguments support derivatives. Taking the derivative once results in a 1D
function, which evaluates to a <code>numpy.ndarray</code>:</p>
<pre><code class="language-python">function.eval(f.derivative('u'), arguments={'u': [1,2,0,5,4]})
# array([0.125, 0.25 , 0.25 , 0.25 , 0.125])
</code></pre>
<p>Since our function <code>f</code> is quadratic in 'u', the second derivative becomes
constant (i.e. independent of arguments) and can be evaluated without any
argument specification:</p>
<pre><code class="language-python">M = f.derivative('u').derivative('u')
function.eval(M)
# array([[ 4., -4.,  0.,  0.,  0.],
#        [-4.,  8., -4.,  0.,  0.],
#        [ 0., -4.,  8., -4.,  0.],
#        [ 0.,  0., -4.,  8., -4.],
#        [ 0.,  0.,  0., -4.,  4.]])
</code></pre>
<p>Observing that this matrix is sparse, it would be more efficient to evaluate
only the nonzero entries and the corresponding indices, so that these can be
used to form an appropriate sparse matric object. For this, the
<code>nutils.function</code> module provides the two modifiers <code>as_coo</code> and <code>as_csr</code>.
The former is valid for objects of any dimension, and return the nonzero values
followed by a number of index vectors equal to the dimension of the array:</p>
<pre><code class="language-python">function.eval(function.as_coo(M))
# (array([ 8., -8., -8., 16., -8., -8., 16., -8., -8., 16., -8., -8.,  8.]),
#  array([0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4]),
#  array([0, 1, 0, 1, 2, 1, 2, 3, 2, 3, 4, 3, 4]))
</code></pre>
<p>The latter of specific to 2D arrays and returns the sparsity structure in
<a href="https://en.wikipedia.org/wiki/Sparse_matrix#Compressed_sparse_row_(CSR,_CRS_or_Yale_format)">compressed sparse
row</a>
format:</p>
<pre><code class="language-python">function.eval(function.as_csr(M))
# (array([ 8., -8., -8., 16., -8., -8., 16., -8., -8., 16., -8., -8.,  8.]),
#  array([ 0,  2,  5,  8, 11, 13]),
#  array([0, 1, 0, 1, 2, 1, 2, 3, 2, 3, 4, 3, 4]))
</code></pre>
<p>Either of these can be used to form a Nutils sparse matrix using the
<code>nutils.matrix.assemble_coo</code> or <code>nutils.matrix.assemble_csr</code> functions, or
any third party sparse matrix of preference.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="solvers"><a class="header" href="#solvers">Solvers</a></h1>
<p>Using topologies, bases and integrals, we now have the tools in place to start
performing some actual functional-analytical operations. We start with what is
perhaps the simplest of its kind, the least squares projection, demonstrating
the different implementations now available to us and working our way up from
there.</p>
<p>Taking the function <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0622em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span> as an example, to project it onto the discrete
space means finding the discrete solution <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span> such that, for all discrete
test functions <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span>:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.2719em;vertical-align:-0.9119em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">Ω</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2719em;vertical-align:-0.9119em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">Ω</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p>
<p>In terms of the discrete coefficients this becomes the linear system <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">nm</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. This is implemented as follows:</p>
<pre><code class="language-python">ns.u = topo.field('u', btype='spline', degree=1)
ns.v = topo.field('v', btype='spline', degree=1)
A, f = function.eval([
    topo.integral('v u dV' @ ns, degree=2).derivative('v').derivative('u'),
    topo.integral('v x_0^2 dV' @ ns, degree=2).derivative('v')])
u = numpy.linalg.solve(A, f)
# array([-0.01041667,  0.05208333,  0.23958333,  0.55208333,  0.98958333])
</code></pre>
<p><img src="tutorial-solvers-fig1.svg" alt="output" /></p>
<p>Alternatively, we can write this in the slightly more general form</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2719em;vertical-align:-0.9119em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">Ω</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.</span></span></span></span></span></p>
<pre><code class="language-python">res = topo.integral('v (u - x_0^2) dV' @ ns, degree=2)
</code></pre>
<p>After taking the derivative with respect to the test function 'v', the
derivative to 'u' gives the above matrix <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>, whereas substitution of the zero
vector for 'u' yields <code>-f</code>. Nutils can compute those derivatives for you, using
the method <code>Array.derivative()</code> to compute the derivative with respect to an
<code>nutils.function.Argument</code>, returning a new <code>nutils.function.Array</code>.</p>
<pre><code class="language-python">A, f = function.eval([
    res.derivative('v').derivative('u'),
    -res.derivative('v')], arguments={'u': numpy.zeros(5)})
u = numpy.linalg.solve(A, f)
# array([-0.01041667,  0.05208333,  0.23958333,  0.55208333,  0.98958333])
</code></pre>
<p>The above three lines are so common that they are combined in the <code>solve</code>
method of <code>nutils.solver.System</code>:</p>
<pre><code class="language-python">args = solver.System(res, trial='u', test='v').solve()
# {'u': array([-0.01041667,  0.05208333,  0.23958333,  0.55208333,  0.98958333])}
</code></pre>
<p>We can take this formulation one step further.  Minimizing</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2719em;vertical-align:-0.9119em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">Ω</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p>
<p>for <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span> is equivalent to the above two variants, as the derivative of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>
to <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span> equals <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>.</p>
<pre><code class="language-python">sqr = topo.integral('(u - x_0)^2 dV' @ ns, degree=2)
solver.System([sqr.derivative('u')], trial='u').solve()
# {'u': array([-0.01041667,  0.05208333,  0.23958333,  0.55208333,  0.98958333])}
</code></pre>
<p>Since <code>sqr.derivative('u')</code> is vector valued, <code>solve</code> understands that its
assignment is to make the entire vector zero, and no test function needs to be
specified. However, we can go one step shorter by providing <code>sqr</code> as is, in
which case <code>solve</code> interprets the absence of the test argument as being equal
to the trial. The result is the same as before, with the added benefit of
informing System that the linear system it is solving is symmetric.</p>
<pre><code class="language-python">solver.System(sqr, trial='u').solve()
# {'u': array([-0.01041667,  0.05208333,  0.23958333,  0.55208333,  0.98958333])}
</code></pre>
<p>The System object also supports solving a partial optimization problem via its
<code>solve_constraints</code> method, so called because this is typically used for
Dirichlet constraints. This method returns an array with <code>nan</code> ('not a number')
for every entry for which the optimization problem is invariant, or to be
precise, where the variation is below the mandatory <code>droptol</code> argument.</p>
<h2 id="putting-it-together"><a class="header" href="#putting-it-together">Putting it together</a></h2>
<p>We are now in a position to consider again the Laplace problem stated above.
The Dirichlet boundary condition at <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">left</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> minimizes the following
functional:</p>
<pre><code class="language-python">sqr = topo.boundary['left'].integral('(u - 1)^2 dS' @ ns, degree=2)
</code></pre>
<p>We use the <code>solve_constraints</code> method to solve this least squares problem for
the single degree of freedom involved, leaving the others at not a number to
signify that the are yet to be defined:</p>
<pre><code class="language-python">cons = solver.System(sqr, trial='u').solve_constraints(droptol=1e-15)
# {'u': array([ 1., nan, nan, nan, nan])}
</code></pre>
<p>The <a href="tutorial-theory.html#weak-form">residual</a> is implemented as</p>
<pre><code class="language-python">res = topo.integral('(∇_k(v) ∇_k(u) + 2 v) dV' @ ns, degree=2)
res -= topo.boundary['right'].integral('v dS' @ ns, degree=2)
</code></pre>
<p>We can use the system's <code>solver</code> method to solve this problem, with the
constraints passed in via the <code>constrain</code> keyword argument:</p>
<pre><code class="language-python">args = solver.System(res, trial='u', test='v').solve(constrain=cons)
# {'u': array([1.    , 0.8125, 0.75  , 0.8125, 1.    ])}
</code></pre>
<p>Note, finally, that the <code>solve</code> method actually does not require the problem to
be linear in 'u' at all; if it is not then it will automatically switch to
Newton iterations unless otherwise specified.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="sampling"><a class="header" href="#sampling">Sampling</a></h1>
<p>Having obtained the coefficient vector that solves the Laplace problem, we are
now interested in visualizing the function it represents. Nutils does not
provide its own post processing functionality, leaving that up to the
preference of the user. It does, however, facilitate it, by allowing
<code>nutils.function.Array</code> functions to be evaluated in samples. Bundling function
values and a notion of connectivity, these form a bridge between Nutils' world
of functions and the discrete realms of <a href="https://matplotlib.org/">matplotlib</a>,
VTK, etc.</p>
<p>The <code>Topology.sample(method, ...)</code> method generates a collection of points on
the <code>nutils.topology.Topology</code>, according to <code>method</code>. The <code>'bezier'</code> method
generates equidistant points per element, including the element vertices.  The
number of points per element per dimension is controlled by the second argument
of <code>Topology.sample()</code>.  An example:</p>
<pre><code class="language-python">bezier = topo.sample('bezier', 2)
</code></pre>
<p>The resulting <code>nutils.sample.Sample</code> object can be used to evaluate
<code>nutils.function.Array</code> functions via the <code>Sample.eval(func)</code> method. To
evaluate the geometry <code>ns.x</code> write</p>
<pre><code class="language-python">x = bezier.eval('x_0' @ ns)
# array([0.  , 0.25, 0.25, 0.5 , 0.5 , 0.75, 0.75, 1.  ])
</code></pre>
<p>The first axis of the returned <code>numpy.ndarray</code> represents the collection of
points.  To reorder this into a sequence of lines in 1D, a triangulation in 2D
or in general a sequence of simplices, use the <code>Sample.tri</code> attribute:</p>
<pre><code class="language-python">x[bezier.tri]
# array([[0.  , 0.25],
#        [0.25, 0.5 ],
#        [0.5 , 0.75],
#        [0.75, 1.  ]])
</code></pre>
<p>Now, the first axis represents the simplices and the second axis the vertices
of the simplices.</p>
<p>If an <code>nutils.function.Array</code> function has arguments, those arguments must be
specified by keyword arguments to <code>Sample.eval()</code>. For example, to evaluate
<code>ns.u</code> with argument <code>lhs</code> replaced by solution vector <code>lhs</code>, obtained using
<code>nutils.solver.solve_linear</code> above, write</p>
<pre><code class="language-python">u = bezier.eval('u' @ ns, arguments=args)
# array([0.  , 0.25, 0.25, 0.5 , 0.5 , 0.75, 0.75, 1.  ])
</code></pre>
<p>We can now plot the sampled geometry <code>x</code> and solution <code>u</code> using <code>matplotlib</code>,
plotting each line in <code>Sample.tri</code> with a different color:</p>
<pre><code class="language-python">pyplot.plot(x[bezier.tri.T], u[bezier.tri.T])
</code></pre>
<p><img src="tutorial-sampling-fig1.svg" alt="output" /></p>
<p>The <code>pyplot.plot()</code> function takes an array of x-values and and array of
y-values, both with the first axis representing vertices and the second
representing separate lines, hence the transpose of <code>bezier.tri</code>.</p>
<p>In our <code>myplot</code> utility function we call <code>nutils.export.triplot</code> to create a
single line plot out of the many segments, aided by its own <code>tri</code> argument for
element connectivity. It further generalizes to 2D (and 3D), as we will see in
the following section.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="2d-laplace-problem"><a class="header" href="#2d-laplace-problem">2D Laplace Problem</a></h1>
<p>All of the above was written for a one-dimensional example.  We now extend the
Laplace problem to two dimensions and highlight the changes to the
corresponding Nutils implementation.  Let <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Ω</span></span></span></span> be a unit square with
boundary <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Γ</span></span></span></span>, on which the following boundary conditions apply:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.7862em;vertical-align:-2.6431em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-1.6em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.592em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.916em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.916em' style='width:0.8889em' viewBox='0 0 888.89 916' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V916 H384z M384 0 H504 V916 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.916em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.916em' style='width:0.8889em' viewBox='0 0 888.89 916' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V916 H384z M384 0 H504 V916 H384z'/></svg></span></span><span style="top:-5.2em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.1431em;"><span style="top:-5.1431em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span><span style="top:-3.7031em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cosh</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-0.7969em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop">cosh</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.6431em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.1431em;"><span style="top:-5.1431em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">left</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.7031em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">bottom</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">right</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.7969em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">top</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.6431em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>The 2D homogeneous Laplace solution is the field <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> for which <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> for all v, where</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2834em;vertical-align:-0.9119em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">Ω</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">∂</span><span class="mord mathnormal">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.475em;vertical-align:-1.115em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.4336em;"><span style="top:-1.7881em;margin-left:-0.4445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">Γ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord text mtight"><span class="mord mtight">right</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.115em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cosh</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">.</span></span></span></span></span></p>
<p>Adopting a Finite Element basis <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span> we obtain the discrete solution
<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and the system of equations <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">u</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>.</p>
<p>Following the same steps as in the 1D case, a unit square mesh with 10x10
elements is formed using <code>nutils.mesh.rectilinear</code>:</p>
<pre><code class="language-python">nelems = 10
topo, geom = mesh.rectilinear([
    numpy.linspace(0, 1, nelems+1), numpy.linspace(0, 1, nelems+1)])
</code></pre>
<p>Recall that <code>nutils.mesh.rectilinear</code> takes a list of element vertices per
dimension.  Alternatively you can create a unit square mesh using
<code>nutils.mesh.unitsquare</code>, specifying the number of elements per dimension and
the element type:</p>
<pre><code class="language-python">topo, geom = mesh.unitsquare(nelems, 'square')
</code></pre>
<p>The above two statements generate exactly the same topology and geometry.  Try
replacing <code>'square'</code> with <code>'triangle'</code> or <code>'mixed'</code> to generate a unit square
mesh with triangular elements or a mixture of square and triangular elements,
respectively.</p>
<p>We start with a clean namespace, assign the geometry to <code>ns.x</code>, create a linear
basis and define the solution <code>ns.u</code> as the contraction of the basis with
argument <code>lhs</code>.</p>
<pre><code class="language-python">ns = Namespace()
ns.x = geom
ns.define_for('x', gradient='∇', normal='n', jacobians=('dV', 'dS'))
ns.u = topo.field('u', btype='std', degree=1)
ns.v = topo.field('v', btype='std', degree=1)
</code></pre>
<p>Note that the above statements are identical to those of the one-dimensional
example.</p>
<p>The residual is implemented as</p>
<pre><code class="language-python">res = topo.integral('∇_k(v) ∇_k(u) dV' @ ns, degree=2)
res -= topo.boundary['right'].integral('v cos(1) cosh(x_1) dS' @ ns, degree=2)
</code></pre>
<p>The Dirichlet boundary conditions are rewritten as a least squares problem and
solved for <code>u</code>, yielding the constraints vector <code>cons</code>:</p>
<pre><code class="language-python">sqr = topo.boundary['left'].integral('u^2 dS' @ ns, degree=2)
sqr += topo.boundary['top'].integral('(u - cosh(1) sin(x_0))^2 dS' @ ns, degree=2)
cons = solver.System(sqr, trial='u').solve_constraints(droptol=1e-15)
# optimize &gt; solve &gt; solving 21 dof system to machine precision using arnoldi solver
# optimize &gt; solve &gt; solver returned with residual 3e-17±2e-15
# optimize &gt; constrained 21/121 dofs
# optimize &gt; optimum value 4.32e-10±1e-9
</code></pre>
<p>To solve the problem <code>res=0</code> for <code>u</code> subject to <code>cons['u']</code> excluding
the <code>nan</code> values, we use the system's <code>solve</code> method:</p>
<pre><code class="language-python">args = solver.System(res, trial='u', test='v').solve(constrain=cons)
# solve &gt; solving 100 dof system to machine precision using arnoldi solver
# solve &gt; solver returned with residual 2e-15±2e-15
</code></pre>
<p>Finally, we plot the solution.  We create a <code>nutils.sample.Sample</code> object from
<code>topo</code> and evaluate the geometry and the solution:</p>
<pre><code class="language-python">myplot(topo, ns.x, ns.u, args)
</code></pre>
<p><img src="tutorial-laplace2d-fig1.svg" alt="output" /></p>
<p>This two-dimensional example is also available as the script <code>examples/laplace.py</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="release-history"><a class="header" href="#release-history">Release History</a></h1>
<p>Nutils is developed on <a href="https://github.com/evalf/nutils">Github</a> and released
at cadence of roughly one year, with the actual time of release depending on
the level of maturity of newly introduced features. Major releases introduce
new features and may deprecate features that have been superceded. Minor
releases contain only bugfixes and are always safe to upgrade to.</p>
<p>Every major release follows the following procedure:</p>
<ul>
<li>The development branch is branched off to release/x, where x is the major
version number</li>
<li>The release is assigned a code name, in alphabetical order, derived from a
type of noodles dish</li>
<li>The release commit is <a href="https://github.com/evalf/nutils/releases">tagged</a> as
vx.0, with minor updates following as vx.1, vx.2 etc</li>
<li>The package is uploaded to <a href="https://pypi.org/project/nutils/">PyPi</a> for easy
installation using pip</li>
<li>The changelog in the development branch is emptied and added to this release
history</li>
</ul>
<h2 id="development-version"><a class="header" href="#development-version">Development version</a></h2>
<p>Since Nutils is under active development and releases are fairly infrequent,
users may choose to work with the development version directly, taking for
granted that their code may require continuous updating as features develop —
keep an eye on the changelog in the project root! The development version is
continuously updated here:</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/heads/main.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/latest/">API Reference</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-9-jook-sing"><a class="header" href="#nutils-9-jook-sing">Nutils 9 Jook-Sing</a></h1>
<p>Nutils 9 was released on April 9, 2025 and saw one point release for fixes and
backports. The most recent version in this series is Nutils 9.1, released on
July 7th, 2025.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v9.1.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v9.1/">API Reference</a></li>
</ul>
<h2 id="whats-new"><a class="header" href="#whats-new">What's new?</a></h2>
<p>These are the main additions and changes since Nutils 8 Idiyappam.</p>
<h3 id="system"><a class="header" href="#system">System</a></h3>
<p>The most prominent new feature of Nutils 9 is arguably the redesign of the
solver module, which now offers the <code>System</code> object as the main entry point for
all linear and nonlinear problems. A typical use looks like this:</p>
<pre><code class="language-python">&gt;&gt;&gt; sys = solver.System(residual, trial='u', test='v')
&gt;&gt;&gt; args = sys.solve(constrain=cons)
</code></pre>
<p>Nonlinear problems require a <code>tol</code> argument, and will switch to a vanilla
newton process by default. Different solution methods, such as line search
newton (solver.LinesearchNewton) or steepest descent minimization
(solver.Minimize) can be specified via the <code>method</code> argument. Newly added
solution methods are solver.ReuseNewton and solver.Arnoldi.</p>
<p>Presently, the main advantage of the new interface is in repeated solves, as
the system object retains information such as the matrix sparsity pattern that
is expensive to recompute. In future, systems will be enhanced to recognize and
exploit features such as one way coupling of matrix blocks. The old functions
such as <code>solve_linear</code> and <code>newton</code> will be deprecated in the next development
cycle for removal in Nutils 11. All examples are updated to use <code>System</code>
directly to encourage new projects to switch over to the new API.</p>
<h3 id="field"><a class="header" href="#field">Field</a></h3>
<p>Nutils 8 initiated the transition from operating on basis functions and vector
valued residuals, to fields, i.e. bases contracted with arguments, and scalar
valued residuals. Nutils 9 further promotes this by providing a new <code>field</code>
method that makes formation of the basis an entirely internal affair. In the
following example, <code>u1</code>, <code>u2</code> and <code>u3</code> are identical:</p>
<pre><code class="language-python">&gt;&gt;&gt; u1 = topo.field('u', btype='spline', degree=2)
&gt;&gt;&gt; basis = topo.basis('spline', degree=2)
&gt;&gt;&gt; u2 = basis @ function.Argument('u', basis.shape)
&gt;&gt;&gt; u3 = function.field('u', basis)
</code></pre>
<p>In the majority of cases that direct acces to the basis is not required, the
first construction is recommended. The second shows what really happens,
discounting some subtle differences in the case of tensorial topologies. The
third form showcases the new function <code>function.field</code>, which was renamed from
<code>function.dotarg</code> for naming consistency. Like its predecessor, this function
can also be used to create constant fields by not providing a basis argument.</p>
<h3 id="factor"><a class="header" href="#factor">Factor</a></h3>
<p>Another standout new feature is <code>function.factor</code>, which offers to speed up
calculations by precomputing assembly loops. Its use is limited to functions
that are already bound to all spaces, e.g. by integration, and that are
polynomial in all their arguments. Building on the previous example, a typical
use would be to factor the system argument:</p>
<pre><code class="language-python">&gt;&gt;&gt; sys = solver.System(function.factor(residual), trial='u', test='v')
</code></pre>
<p>Here, residual must by polynomial in 'u' and 'v'. Factor then evaluates the
polynomial coefficients as sparse arrays. Finally, when System evaluates the
resulting function, this amounts to nothing more than sparse tensor
contractions, which can be very fast. Note, however, a high polynomial degree
results in high-dimensional coefficients which, while sparse, may still require
a lot of memory and many operations to perform the required contractions. As
such, the benefits of factor should be assessed on a case by case basis.</p>
<p>Two examples that benefit greatly from the factor treatment are cylinderflow
and cahnhilliard. In another useful application of factor, these scripts have
greatly sped up post processing by factoring sampled results. The <code>Sample.bind</code>
method used for this purpose is also new in Nutils 9.</p>
<h3 id="jit-compiler"><a class="header" href="#jit-compiler">JIT compiler</a></h3>
<p>Under the hood, a major change in the evaluable module is the way that
functions are evaluated. Where evaluations formerly consisted of a (dynamically
created) sequence of function calls, Nutils 9 generates and compiles a
dedicated Python function. The direct result of this change is a reduction in
function calls, which lowers the total overhead and shifts the balance of total
time spent to the actual numerical operations.</p>
<p>The compiled function furthermore distinguishes between (intermediate) results
that depend on input arguments, and those that stay constant between
evaluations. The latter are stored as part of the function object and reused
when the function is evaluated for the second time. Noting that part of the
non-changing structures in a function is the entire sparsity pattern, it should
be clear that these are significant savings. This also another reason why the
switch to the new solver API is vital, as the System object holds on to the
compiled function along with its cached data.</p>
<p>Thirdly, the new approach allows for in-place modifications. Formerly, a sparse
matrix was assembled by concatenating element contributions before
deduplicating and converting it to CSR format. The new approach adds element
data directly into the CSR structure, resulting in substantial memory savings.</p>
<h3 id="other-notable-changes"><a class="header" href="#other-notable-changes">Other notable changes</a></h3>
<p>The <a href="https://examples.nutils.org/official-turek/">turek example</a> is added as an
implementation of the <a href="https://doi.org/10.1007/3-540-34596-5_15">Turek Hron
benchmark</a>, able to reproduce all of
the 9 distinct benchmark cases as well as freely defined variants thereof. The
new benchmark section in this book contains convergence results of the code,
compared against the reference results of Turek and Hron.</p>
<p>The <code>mesh.gmsh</code> function has been enhanced to accept .geo paths in addition to
the already supported '.msh' files. The new mode requires gmsh to be installed
in the executable path, and uses it to generate the corresponding msh file on
the fly. The new <code>numbers</code> parameter provides for parameterized input, in the
form of a dictionary with variables for the geo file. The new turek example
showcases this new ability.</p>
<p>Support for SI units has been extended to the Numpy operations <code>real</code>, <code>imag</code>,
<code>conjugate</code>, <code>reshape</code>, <code>linalg.norm</code> and <code>interp</code>. The new <code>Sample.bind</code>
method is unit aware. Finally, <code>Topology.locate</code> now accepts dimensional
quantities provided that the geometry function and points array have matching
dimension, as well as the <code>tol</code> argument if provided.</p>
<p>On the dependencies front, Nutils now requires Python 3.9 or higher, as these
are the only versions still activaly maintained. Likewise, the minimum Numpy
version has been bumped to 1.21. On the other end of the spectrum, support is
added for Numpy series 2. The bottombar and psutil modules are removed as
dependencies, but will still be used by cli.run and cli.choose if they are
detected to be installed. Finally, the MKL matrix will be automatically
recognized with the mkl module is user-installed via pip.</p>
<h3 id="deprecations"><a class="header" href="#deprecations">Deprecations</a></h3>
<p>The following constructs have been deprecated and are marked for removal in Nutils 10:</p>
<ul>
<li>matrix.assemble (replaced by matrix.assemble_coo and matrix.assemble_csr)</li>
<li>function.dotarg (replaced by function.field)</li>
<li>function.outer (replaced by the equivalent numpy operations)</li>
<li>sample.Sample callable (replaced by Sample.bind)</li>
<li>function.integral (replaced by Sample.integral)</li>
<li>function.sample (replaced by Sample.bind)</li>
<li>function.rootcoords (no replacement)</li>
<li>sample.Sample.integrate_sparse (replaced by function.eval + function.as_coo + sample.Sample.integral)</li>
<li>sample.Sample.eval_sparse (replaced by function.eval + function.as_coo + sample.Sample.bind)</li>
<li>providing arguments as keywords (replaced by the 'arguments' parameter)</li>
<li>the newly introduced 'legacy' argument in functon.Array.eval and sample.Sample.integrate</li>
</ul>
<h2 id="complete-overview-of-changes"><a class="header" href="#complete-overview-of-changes">Complete overview of changes</a></h2>
<p>This release cycle was the first where we assigned version numbers to every
commit in the main branch. Since the version is logged at the top (when using
<code>cli.run</code>), this should always make it unambiguously clear what version of the
code was used to generate past results, even if this was part of the
development branch.</p>
<p>In the following overview, the versions indicate when a certain feature was
introduced, changed, fixed or deprecaded, and, if applicable, when it was
backported into the stable branch.</p>
<ul>
<li><em>New in v9a1:</em> support diagonal offset in numpy.trace</li>
<li><em>Changed in v9a1:</em> minimum Python version 3.8</li>
<li><em>Changed in v9a2, v8.1:</em> log version in cli.run, cli.choose</li>
<li><em>Changed in v9a3:</em> update Docker base image to Debian Bookworm</li>
<li><em>Fixed in v9a3, v8.3:</em> missing points in trimmed topology with skip_missing=True</li>
<li><em>New in v9a4, v8.3:</em> support numpy.{real,imag,conjugate} on Quantities</li>
<li><em>New in v9a4, v8.3:</em> support complex arguments in function.linearize</li>
<li><em>Fixed in v9a6, v8.4:</em> basis of SimplexTopology</li>
<li><em>Fixed in v9a6, v8.4:</em> empty boundary of SimplexTopology, triggered when all boundaries are periodic</li>
<li><em>Fixed in v9a7, v8.4:</em> picklability of sliced function array</li>
<li><em>New in v9a10:</em> support boolean operators for function arrays</li>
<li><em>Changed in v9a12:</em> internal: removed remove evaluable.Points,NPoints,Weights</li>
<li><em>Fixed in v9a14, v8.5:</em> pyproject version constraints</li>
<li><em>New in v9a15, v8.6:</em> support locate for tensorial topologies</li>
<li><em>New in v9a17:</em> make svg graphs interactive</li>
<li><em>Changed in v9a19:</em> more efficient geometry function for equidistant rectilinear mesh</li>
<li><em>Fixed in v9a20, v8.7:</em> logging of parameters without type annotation</li>
<li><em>Fixed in v9a21:</em> SI handling of special binary methods</li>
<li><em>Changed in v9a24:</em> fill nested subgraphs with distinct bg colors</li>
<li><em>Changed in v9a25:</em> add evaluable.Singular</li>
<li><em>Fixed in v9a25, v8.7:</em> simplification of Equals involving Range</li>
<li><em>Fixed in v9a28, v8.7:</em> multipatch interfaces</li>
<li><em>New in v9a30:</em> add evaluable.compile: a Python code generator</li>
<li><em>Changed in v9a33:</em> evaluable.Array now derived from types.DataClass</li>
<li><em>Fixed in v9a35:</em> parsegmsh in presence of multiple periodicity</li>
<li><em>Fixed in v9a35:</em> parsegmsh's handling of empty physical groups</li>
<li><em>Fixed in v9a36:</em> getpoints for empty mosaic elements</li>
<li><em>Fixed in v9a36:</em> 'not watertight' trimming issues</li>
<li><em>Changed in v9a37:</em> reduce unnecessary evaluations for shape checks during function formation</li>
<li><em>New in v9a37:</em> matrix.assemble_coo, .assemble_csr, .assemble_block_csr</li>
<li><em>New in v9a37:</em> evaluable.eval_coo, .unique, .as_csr</li>
<li><em>New in v9a37:</em> solver.System</li>
<li><em>Fixed in v9a37:</em> deprecated tol argument in scipy&gt;=1.12</li>
<li><em>Deprecated in v9a37:</em> matrix.assemble (replaced by matrix.assemble_coo, matrix.assemble_csr)</li>
<li><em>Changed in v9a39:</em> disable graphviz node background if ncalls == 0</li>
<li><em>New in v9a39:</em> function.factor</li>
<li><em>Fixed in v9a40:</em> disallow truncation in types.arraydata</li>
<li><em>Fixed in v9a41:</em> Gramm-Schmidt breakdown in Arnoldi solver</li>
<li><em>New in v9a42:</em> support Numpy 2</li>
<li><em>Changed in v9a44:</em> remove psutil and bottombar dependencies</li>
<li><em>Changed in v9a45:</em> automatically load mkl from pip user install</li>
<li><em>Changed in v9a46:</em> add argument checks to mesh.simplex</li>
<li><em>Changed in v9a46:</em> extend mesh.gmsh with ability to convert geo files</li>
<li><em>New in v9a47:</em> allow iterator argument in function.vectorize</li>
<li><em>New in v9a47:</em> topology.field method</li>
<li><em>Changed in v9a47:</em> rename dotarg to field</li>
<li><em>Deprecated in v9a47:</em> dotarg (replaced by field)</li>
<li><em>New in v9a49:</em> Turek benchmark example</li>
<li><em>New in v9a50:</em> SI support for reshape, linalg.norm, interp</li>
<li><em>New in v9a51:</em> vorticity plot in drivencavity example</li>
<li><em>Changed in v9a52:</em> support SI arguments in Topology.locate</li>
<li><em>Changed in v9a52:</em> support locating points on manifolds</li>
<li><em>New in v9a53:</em> sample.bind</li>
<li><em>Changed in v9a53:</em> minimum Python version 3.9</li>
<li><em>Changed in v9a53:</em> minimum Numpy version 1.21</li>
<li><em>Changed in v9a53:</em> extend numpy.interp to functions with points</li>
<li><em>Fixed in v9a53:</em> zipping tensorial samples</li>
<li><em>Fixed in v9a53:</em> graph of evaluables with nested loops</li>
<li><em>Deprecated in v9a53:</em> function.outer</li>
<li><em>Deprecated in v9a53:</em> sample callable (replaced by .bind)</li>
<li><em>Deprecated in v9a53:</em> function.integral, function.sample</li>
<li><em>Changed in v9a54:</em> simplify TransformLinear, TransformBasis if constant</li>
<li><em>Changed in v9a54:</em> simplify evaluable.Transform* with masked source</li>
<li><em>Deprecated in v9a54:</em> function.rootcoords</li>
<li><em>Changed in v9a55</em>: sparse deduplication during evaluation</li>
<li><em>New in v9a55</em>: sparse modifiers function.as_coo and function.as_csr</li>
<li><em>New in v9a58</em>: ability to select spaces in function.grad, Namespace.define_for</li>
<li><em>Deprecated in v9a60</em>: sample.integrate_sparse, Sample.eval_sparse</li>
<li><em>Deprecated in v9a60</em>: arguments via keywords (replaced by the 'arguments' parameter)</li>
<li><em>New in v9a60</em>: legacy parameter in Array.eval, Sample.integrate</li>
<li><em>New in v9a62</em>: solver methods ReuseNewton and Arnoldi</li>
<li><em>New in v9a63</em>: support nested integrals over the same space</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-8-idiyappam"><a class="header" href="#nutils-8-idiyappam">Nutils 8 Idiyappam</a></h1>
<p>Nutils 8 was released on July 28th, 2023 and saw eight point releases for fixes
and backports. The most recent and final version in this series is Nutils 8.8,
released on July 9th, 2024.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v8.8.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v8.3/">API Reference</a></li>
</ul>
<h2 id="whats-new-1"><a class="header" href="#whats-new-1">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-7.html">Nutils 7
Hiyamugi</a>.</p>
<h3 id="new-si-module-for-physical-units"><a class="header" href="#new-si-module-for-physical-units">New: SI module for physical units</a></h3>
<p>The SI module provides a framework for checking the dimensional consistency of
a formulation at runtime, as well as tools to convert between different units
for post processing. Extensive documentation can be found in the <a href="https://docs.nutils.org/en/v8.0/nutils/SI/#module-nutils.SI">SI
module</a>. The
framework can be seen in action in the <a href="https://examples.nutils.org/official-cahnhilliard/">cahnhilliard
example</a>, with more
examples to be converted in future.</p>
<h3 id="new-support-for-einsum-and-other-numpy-operations"><a class="header" href="#new-support-for-einsum-and-other-numpy-operations">New: support for einsum and other Numpy operations</a></h3>
<p>Support for Numpy operations on Nutils arrays has been extended to include:</p>
<ul>
<li><code>numpy.choose</code></li>
<li><code>numpy.cross</code></li>
<li><code>numpy.diagonal</code></li>
<li><code>numpy.einsum</code></li>
<li><code>numpy.interp</code> (array support limited to <code>x</code> argument)</li>
<li><code>numpy.linalg.det</code></li>
<li><code>numpy.linalg.eig</code></li>
<li><code>numpy.linalg.eigh</code></li>
<li><code>numpy.linalg.inv</code></li>
<li><code>numpy.linalg.norm</code></li>
<li><code>numpy.searchsorted</code> (array support limited to <code>v</code> argument)</li>
</ul>
<h3 id="new-test-fields-and-residual-functionals"><a class="header" href="#new-test-fields-and-residual-functionals">New: test fields and residual functionals</a></h3>
<p>The <code>nutils.solver</code> methods have been generalized to accept scalar valued
functionals, from which residual vectors are derived through differentiation.
To this end, a trial/test function pair can be specified as a solve target
separated by a colon, as in the following example:</p>
<pre><code class="language-python">ns.add_field(('u', 'v'), topo.basis('std', degree=1))
res = topo.integral('∇_i(u) ∇_i(v) dV' @ ns, degree=2)
args = solver.newton('u:v', res).solve(1e-10)
</code></pre>
<p>Multiple fields can either comma-joined or provided as a tuple. Note that the
colon automatically triggers a new-style dictionary return value, even in
absence of a trialing comma as in the above example.</p>
<h3 id="new-namespaceadd_field"><a class="header" href="#new-namespaceadd_field">New: Namespace.add_field</a></h3>
<p>The namespace from the <code>nutils.expression_v2</code> module newly provides the
<code>nutils.expression_v2.Namespace.add_field</code> method, as a convenient shorthand
for creating fields with the same name as their arguments. That is:</p>
<pre><code class="language-python">ns.add_field(('u', 'v'), topo.basis('std', degree=1), shape=(2,))
</code></pre>
<p>is equivalent to</p>
<pre><code class="language-python">basis = topo.basis('std', degree=1)
ns.u = function.dotarg('u', basis, shape=(2,))
ns.v = function.dotarg('v', basis, shape=(2,))
</code></pre>
<h3 id="new-shorthand-notation-for-multiple-solver-targets"><a class="header" href="#new-shorthand-notation-for-multiple-solver-targets">New: shorthand notation for multiple solver targets</a></h3>
<p>Multiple solver targets can now be specified as a comma-separated string, as a
shorthand for the string tuple that will remain a valid argument. This means
the following two invocations are equivalent:</p>
<pre><code class="language-python">args = solver.newton(('u', 'p'), (ures, pres)).solve(1e-10)
args = solver.newton('u,p', (ures, pres)).solve(1e-10)
</code></pre>
<p>To distinguish single-length tuples from the single argument legacy notation,
the former requires a trailing comma. I.e., the following are NOT equivalent:</p>
<pre><code class="language-python">args = solver.newton('u,', (ures,)).solve(1e-10)
u = solver.newton('u', ures).solve(1e-10)
</code></pre>
<h3 id="new-nearest-neighbour-interpolation-in-sampleasfunction-samplebasis"><a class="header" href="#new-nearest-neighbour-interpolation-in-sampleasfunction-samplebasis">New: nearest-neighbour interpolation in sample.asfunction, sample.basis</a></h3>
<p>The sample methods <code>asfunction</code> and <code>basis</code> have a new interpolation argument
that take the string values "none" (default) or "nearest". The latter activates
a new mode that allows evaluation of sampled data on other samples than the
original by selecting the point that is closest to the target.</p>
<h3 id="new-functionlinearize"><a class="header" href="#new-functionlinearize">New: function.linearize</a></h3>
<p>Similar to <code>derivative</code>, the new function <code>linearize</code> takes the derivative of
an array to one or more arguments, but with the derivative directions
represented by arguments rather than array axes. This is particularly useful in
situations where weak forms are made up of symmetric, energy like components,
combined with terms that require dedicated test fields.</p>
<h3 id="new-option-to-disable-newtons-line-search"><a class="header" href="#new-option-to-disable-newtons-line-search">New: option to disable Newton's line search</a></h3>
<p>The <code>linesearch</code> argument of <code>solver.newton</code> can now receive the <code>None</code> value
to indicate that line search is to be disabled. Additionally, the legacy
arguments <code>searchrange</code> and <code>rebound</code> have been deprecated, and should be
replaced by <code>linesearch=solver.NormBased(minscale=searchrange[0], acceptscale=searchrange[1], maxscale=rebound)</code>.</p>
<h3 id="new-iteration-count-via-infoniter"><a class="header" href="#new-iteration-count-via-infoniter">New: iteration count via info.niter</a></h3>
<p>The info struct returned by <code>solve_withinfo</code> newly contains the amount of
iterations as the <code>niter</code> attribute:</p>
<pre><code class="language-python">res, info = solver.newton('u:v', res).solve_withinfo(1e-10, maxiter=10)
assert info.niter &lt;= 10
</code></pre>
<h3 id="improved-more-efficient-trimming"><a class="header" href="#improved-more-efficient-trimming">Improved: more efficient trimming</a></h3>
<p>The trim routine (which is used for the Finite Cell Method) is rewritten for
speed and to produce more efficient quadrature schemes. The changes relate to
the subdivision at the deepest refinement level. While this step used to
introduce auxiliary vertices at every dimension (lines, faces, volumes), the
new implementation limits the introduction of vertices to the line segments
only, resulting in a subdivision that consists of fewer simplices and
consequently fewer quadrature points.</p>
<h3 id="changed-solve-solve_withinfo-arguments"><a class="header" href="#changed-solve-solve_withinfo-arguments">Changed: solve, solve_withinfo arguments</a></h3>
<p>Solver methods newton, minimize and pseudotime have their function signature
slightly changed:</p>
<ol>
<li>The tol argument (used to define the stop criterion) has been made
mandatory. As the default value used to be 0 - an unreacheable value in
practice - the argument was effectively mandatory already, which this change
formalizes.</li>
<li>The maxiter argument was off by 1, leading maxiter=n to accept
n+1 iterations. This mistake is now fixed, which may break applications that
relied on the former erroneous behaviour.</li>
</ol>
<h3 id="fixed-locate-points-on-trimmed-topologies-with-the-skip_missing-flag-set"><a class="header" href="#fixed-locate-points-on-trimmed-topologies-with-the-skip_missing-flag-set">Fixed: locate points on trimmed topologies with the skip_missing flag set</a></h3>
<p>The <code>locate</code> method has a <code>skip_missing</code> argument that instructs the method to
silently drop points that can not be located on the topology. This setting was
partially ignored by trimmed topologies which could lead to a <code>LocateError</code>
despite the flag being set. This issue is now fixed.</p>
<h3 id="removed-nutils-configuration-file"><a class="header" href="#removed-nutils-configuration-file">Removed: Nutils configuration file</a></h3>
<p>Support for the Nutils configuration file (which used to be located in either
~/.nutilsrc or ~/.config/nutils/config) has been removed. Instead, the
following environment variables can be set to override the default Nutils
settings:</p>
<ul>
<li>NUTILS_PDB  = yes|no</li>
<li>NUTILS_GRACEFULEXIT = yes|no</li>
<li>NUTILS_OUTROOTDIR = path/to/html/logs</li>
<li>NUTILS_OUTROOTURI = uri/to/html/logs</li>
<li>NUTILS_SCRIPTNAME = myapp</li>
<li>NUTILS_OUTDIR = path/to/this/html/log</li>
<li>NUTILS_OUTURI = uti/to/this/html/log</li>
<li>NUTILS_RICHOUTPUT = yes|no</li>
<li>NUTILS_VERBOSE = 1|2|3|4</li>
<li>NUTILS_MATRIX = numpy|scipy|mkl|auto</li>
<li>NUTILS_NPROCS = 1|2|...</li>
<li>NUTILS_CACHE = yes|no</li>
<li>NUTILS_CACHEDIR = path/to/cache</li>
</ul>
<h3 id="deprecated-function-methods-that-have-numpy-equivalents"><a class="header" href="#deprecated-function-methods-that-have-numpy-equivalents">Deprecated: function methods that have Numpy equivalents</a></h3>
<p>The <code>nutils.function</code> methods that have direct equivalents in the <code>numpy</code>
module (<code>function.sum</code>, <code>function.sqrt</code>, <code>function.sin</code>, etc) have been
deprecated in favour of using Numpy's methods (<code>numpy.sum</code>, <code>numpy.sqrt</code>,
<code>numpy.sin</code>, etc) and will be removed in the next release. Ultimately, only
methods that relate to the variable nature of function arrays and therefore
have no Numpy equivalent, such as <code>function.grad</code> and <code>function.normal</code>, will
remain in the function module.</p>
<p>Be aware that some functions were not 100% equivalent to their Numpy
counterpart. For instance, <code>function.max</code> is the equivalent to <code>numpy.maximum</code>,
as the deprecation message helpfully points out. More problematically,
<code>function.dot</code> behaves very differently from both <code>numpy.dot</code> and
<code>numpy.matmul</code>. Porting the code over to equivalent instructions will therefore
require some attention.</p>
<h3 id="deprecated-arraydot-for-ndim--1"><a class="header" href="#deprecated-arraydot-for-ndim--1">Deprecated: Array.dot for ndim != 1</a></h3>
<p>The <code>nutils.function.Array.dot</code> method is incompatible with Numpy's equivalent
method for arrays of ndim != 1, or when axes are specified (which Numpy does
not allow). Aiming for 100% compatibility, the next release cycle will remove
the axis argument and temporarily forbid arguments of ndim != 1. The release
cycle thereafter will re-enable arguments with ndim != 1, with logic equal to
Numpy's method. In the meantime, the advice is to rely on <code>numpy.dot</code>,
<code>numpy.matmul</code> or the <code>@</code> operator instead.</p>
<h3 id="deprecated-arraysum-for-ndim--1-without-axis-argument"><a class="header" href="#deprecated-arraysum-for-ndim--1-without-axis-argument">Deprecated: Array.sum for ndim &gt; 1 without axis argument</a></h3>
<p>The <code>nutils.function.Array.sum</code> method by default operates on the last axis.
This is different from Numpy's behavour, which by default sums all axes. Aiming
for 100% compatibility, the next release cycle will make the axis argument
mandatory for any array of ndim &gt; 1. The release cycle thereafter will
reintroduce the default value to match Numpy's. To prepare for this, relying on
the current default now triggers a deprecation warning.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-7-hiyamugi"><a class="header" href="#nutils-7-hiyamugi">Nutils 7 Hiyamugi</a></h1>
<p>Nutils 7 was released on January 1st, 2022 and saw three point releases for
fixes and backports. The most recent and final version in this series is Nutils
7.3, released on June 20th, 2023.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v7.3.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v7.3/">API Reference</a></li>
</ul>
<h2 id="whats-new-2"><a class="header" href="#whats-new-2">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-6.html">Nutils 6
Garak-Guksu</a>.</p>
<h3 id="expression-and-namespace-version-2"><a class="header" href="#expression-and-namespace-version-2">Expression and Namespace Version 2</a></h3>
<p>The <code>nutils.expression</code> module has been renamed to <code>nutils.expression_v1</code>, the
<code>nutils.function.Namespace</code> class to <code>nutils.expression_v1.Namespace</code> and the
<code>nutils.expression_v2</code> module has been added, featuring a new
<code>nutils.expression_v2.Namespace</code>. The version 2 of the namespace v2 has an
expression language that differs slightly from version 1, most notably in the
way derivatives are written. The old namespace remains available for the time
being. All examples are updated to the new namespace. You are encouraged to use
the new namespace for newly written code.</p>
<h3 id="changed-bifurcate-has-been-replaced-by-spaces"><a class="header" href="#changed-bifurcate-has-been-replaced-by-spaces">Changed: bifurcate has been replaced by spaces</a></h3>
<p>In the past using functions on products of <code>nutils.topology.Topology</code> instances
required using <code>function.bifurcate</code>. This has been replaced by the concept of
'spaces'. Every topology is defined in a space, identified by a name (<code>str</code>).
Functions defined on some topology are considered constant on other topologies
(defined on other spaces).</p>
<p>If you want to multiply two topologies, you have to make sure that the
topologies have different spaces, e.g. via the <code>space</code> parameter of
<code>nutils.mesh.rectilinear</code>. Example:</p>
<pre><code class="language-python">from nutils import mesh, function
Xtopo, x = mesh.rectilinear([4], space='X')
Ytopo, y = mesh.rectilinear([2], space='Y')
topo = Xtopo * Ytopo
geom = function.concatenate([x, y])
</code></pre>
<h3 id="changed-functionarray-shape-must-be-constant"><a class="header" href="#changed-functionarray-shape-must-be-constant">Changed: function.Array shape must be constant</a></h3>
<p>Resulting from to the function/evaluable split introduced in #574, variable
length axes such as relating to integration points or sparsity can stay
confined to the evaluable layer. In order to benefit from this situation and
improve compatibility with Numpy's arrays, <code>nutils.function.Array</code> objects are
henceforth limited to constant shapes. Additionally:</p>
<ul>
<li>The sparsity construct <code>nutils.function.inflate</code> has been removed;</li>
<li>The <code>nutils.function.Elemwise</code> function requires all element arrays to be of
the same shape, and its remaining use has been deprecated in favor of
<code>nutils.function.get</code>;</li>
<li>Aligning with Numpy's API, <code>nutils.function.concatenate</code> no longer
automatically broadcasts its arguments, but instead demands that all
dimensions except for the concatenation axis match exactly.</li>
</ul>
<h3 id="changed-locate-arguments"><a class="header" href="#changed-locate-arguments">Changed: locate arguments</a></h3>
<p>The <code>nutils.topology.Topology.locate</code> method now allows <code>tol</code> to be left
unspecified if <code>eps</code> is specified instead, which is repurposed as stop
criterion for distances in element coordinates. Conversely, if only <code>tol</code> is
specified, a corresponding minimal <code>eps</code> value is set automatically to match
points near element edges. The <code>ischeme</code> and <code>scale</code> arguments are deprecated
and replaced by <code>maxdist</code>, which can be left unspecified in general. The
optional <code>weights</code> argument results in a sample that is suitable for
integration.</p>
<h3 id="moved-unit-from-types-to-separate-module"><a class="header" href="#moved-unit-from-types-to-separate-module">Moved: unit from types to separate module</a></h3>
<p>The <code>unit</code> type has been moved into its own <code>nutils.unit</code> module, with the old
location <code>types.unit</code> now holding a forward method. The forward emits a
deprecation warning prompting to change <code>nutils.types.unit.create</code> (or its
shorthand <code>nutils.types.unit</code>) to <code>nutils.unit.create</code>.</p>
<h3 id="removed-loading-libraries-from-local"><a class="header" href="#removed-loading-libraries-from-local">Removed: loading libraries from .local</a></h3>
<p>Libraries that are installed in odd locations will no longer be automatically
located by Nutils (see b8b7a6d5 for reasons). Instead the user will need to set
the appropriate environment variable, prior to starting Python. In Windows this
is the <code>PATH</code> variable, in Linux and OS X <code>LD_LIBRARY_PATH</code>.</p>
<p>Crucially, this affects the MKL libraries when they are user-installed via pip.
By default Nutils selects the best available matrix backend that it finds
available, which could result in it silently falling back on Scipy or Numpy. To
confirm that the path variable is set correctly run your application with
<code>matrix=mkl</code> to force an error if MKL cannot be loaded.</p>
<h3 id="function-module-split-into-function-and-evaluable"><a class="header" href="#function-module-split-into-function-and-evaluable">Function module split into <code>function</code> and <code>evaluable</code></a></h3>
<p>The function module has been split into a high-level, numpy-like <code>function</code>
module and a lower-level <code>evaluable</code> module. The <code>evaluable</code> module is agnostic
to the so-called points axis. Scripts that don't use custom implementations of
<code>function.Array</code> should work without modification.</p>
<p>Custom implementations of the old <code>function.Array</code> should now derive from
<code>evaluable.Array</code>. Furthermore, an accompanying implementation of
<code>function.Array</code> should be added with a <code>prepare_eval</code> method that returns the
former.</p>
<p>The following example implementation of an addition</p>
<pre><code class="language-python">class Add(function.Array):
  def __init__(self, a, b):
    super().__init__(args=[a, b], shape=a.shape, dtype=a.dtype)
  def evalf(self, a, b):
    return a+b
</code></pre>
<p>should be converted to</p>
<pre><code class="language-python">class Add(function.Array):
  def __init__(self, a: function.Array, b: function.Array) -&gt; None:
    self.a = a
    self.b = b
    super().__init__(shape=a.shape, dtype=a.dtype)
  def prepare_eval(self, **kwargs) -&gt; evaluable.Array:
    a = self.a.prepare_eval(**kwargs)
    b = self.b.prepare_eval(**kwargs)
    return Add_evaluable(a, b)

class Add_evaluable(evaluable.Array):
  def __init__(self, a, b):
    super().__init__(args=[a, b], shape=a.shape, dtype=a.dtype)
  def evalf(self, a, b):
    return a+b
</code></pre>
<h3 id="solve-multiple-residuals-to-multiple-targets"><a class="header" href="#solve-multiple-residuals-to-multiple-targets">Solve multiple residuals to multiple targets</a></h3>
<p>In problems involving multiple fields, where formerly it was required to
<code>nutils.function.chain</code> the bases in order to construct and solve a block
system, an alternative possibility is now to keep the residuals and targets
separate and reference the several parts at the solving phase:</p>
<pre><code class="language-python"># old, still valid approach
ns.ubasis, ns.pbasis = function.chain([ubasis, pbasis])
ns.u_i = 'ubasis_ni ?dofs_n'
ns.p = 'pbasis_n ?dofs_n'

# new, alternative approach
ns.ubasis = ubasis
ns.pbasis = pbasis
ns.u_i = 'ubasis_ni ?u_n'
ns.p = 'pbasis_n ?p_n'

# common: problem definition
ns.σ_ij = '(u_i,j + u_j,i) / Re - p δ_ij'
ures = topo.integral('ubasis_ni,j σ_ij d:x d:x' @ ns, degree=4)
pres = topo.integral('pbasis_n u_,kk d:x' @ ns, degree=4)

# old approach: solving a single residual to a single target
dofs = solver.newton('dofs', ures + pres).solve(1e-10)

# new approach: solving multiple residuals to multiple targets
state = solver.newton(['u', 'p'], [ures, pres]).solve(1e-10)
</code></pre>
<p>In the new, multi-target approach, the return value is no longer an array but a
dictionary that maps a target to its solution. If additional arguments were
specified to newton (or any of the other solvers) then these are copied into
the return dictionary so as to form a complete state, which can directly be
used as an arguments to subsequent evaluations.</p>
<p>If an argument is specified for a solve target then its value is used as an
initial guess (newton, minimize) or initial condition (thetamethod). This
replaces the <code>lhs0</code> argument which is not supported for multiple targets.</p>
<h3 id="new-thetamethod-argument-deprecates-target0"><a class="header" href="#new-thetamethod-argument-deprecates-target0">New thetamethod argument deprecates target0</a></h3>
<p>To explicitly refer to the history state in <code>nutils.solver.thetamethod</code> and its
derivatives <code>impliciteuler</code> and <code>cranknicolson</code>, instead of specifiying the
target through the <code>target0</code> parameter, the new argument <code>historysuffix</code>
specifies only the suffix to be added to the main target. Hence, the following
three invocations are equivalent:</p>
<pre><code class="language-python"># deprecated
solver.impliciteuler('target', residual, inertia, target0='target0')
# new syntax
solver.impliciteuler('target', residual, inertia, historysuffix='0')
# equal, since '0' is the default suffix
solver.impliciteuler('target', residual, inertia)
</code></pre>
<h3 id="in-place-modification-of-newton-minimize-pseudotime-iterates"><a class="header" href="#in-place-modification-of-newton-minimize-pseudotime-iterates">In-place modification of newton, minimize, pseudotime iterates</a></h3>
<p>When <code>nutils.solver.newton</code>, <code>nutils.solver.minimize</code> or
<code>nutils.solver.pseudotime</code> are used as iterators, the generated vectors are now
modified in place. Therefore, if iterates are stored for analysis, be sure to
use the <code>.copy</code> method.</p>
<h3 id="deprecated-functionelemwise"><a class="header" href="#deprecated-functionelemwise">Deprecated function.elemwise</a></h3>
<p>The function <code>function.elemwise</code> has been deprecated. Use <code>function.Elemwise</code>
instead:</p>
<pre><code class="language-python">function.elemwise(topo.transforms, values) # deprecated
function.Elemwise(values, topo.f_index) # new
</code></pre>
<h3 id="removed-transforms-attribute-of-bases"><a class="header" href="#removed-transforms-attribute-of-bases">Removed transforms attribute of bases</a></h3>
<p>The <code>transforms</code> attribute of bases has been removed due to internal
restructurings. The <code>transforms</code> attribute of the topology on which the
basis was created can be used as a replacement:</p>
<pre><code class="language-python">reftopo = topo.refined
refbasis = reftopo.basis(...)
supp = refbasis.get_support(...)
#topo = topo.refined_by(refbasis.transforms[supp]) # no longer valid
topo = topo.refined_by(reftopo.transforms[supp]) # still valid
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-6-garak-guksu"><a class="header" href="#nutils-6-garak-guksu">Nutils 6 Garak-Guksu</a></h1>
<p>Nutils 6 was released on April 29th, 2020 and saw three point releases for
fixes and backports. The most recent and final version in this series is Nutils
6.3, released on November 18th, 2021.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v6.3.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v6.3/">API Reference</a></li>
</ul>
<h2 id="whats-new-3"><a class="header" href="#whats-new-3">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-5.html">Nutils 5
Farfalle</a>.</p>
<h3 id="sparse-module"><a class="header" href="#sparse-module">Sparse module</a></h3>
<p>The new <code>nutils.sparse</code> module introduces a data type and a suite of
manipulation methods for arbitrary dimensional sparse data. The existing
integrate and integral methods now create data of this type under the hood, and
then convert it to a scalar, Numpy array or <code>nutils.matrix.Matrix</code> upon return.
To prevent this conversion and receive the sparse objects instead use the new
<code>nutils.sample.Sample.integrate_sparse</code> or
<code>nutils.sample.eval_integrals_sparse</code>.</p>
<h3 id="external-dependency-for-parsing-gmsh-files"><a class="header" href="#external-dependency-for-parsing-gmsh-files">External dependency for parsing gmsh files</a></h3>
<p>The <code>nutils.mesh.gmsh</code> method now depends on the external
<a href="https://github.com/nschloe/meshio">meshio</a> module to parse .msh files:</p>
<pre><code class="language-sh">python3 -m pip install --user --upgrade meshio
</code></pre>
<h3 id="change-dof-order-in-basisvector"><a class="header" href="#change-dof-order-in-basisvector">Change dof order in basis.vector</a></h3>
<p>When creating a vector basis using <code>topo.basis(..).vector(nd)</code>, the order of
the degrees of freedom changed from grouping by vector components to grouping
by scalar basis functions:</p>
<pre><code>[b0,  0]         [b0,  0]
[b1,  0]         [ 0, b0]
[.., ..] old     [b1,  0]
[bn,  0] ------&gt; [ 0, b1]
[ 0, b0]     new [.., ..]
[.., ..]         [bn,  0]
[ 0, bn]         [ 0, bn]
</code></pre>
<p>This should not affect applications unless the solution vector is manipulated
directly, such as might happen in unit tests. If required for legacy purposes
the old vector can be retrieved using <code>old = new.reshape(-1,nd).T.ravel()</code>.
Note that the change does not extend to <code>nutils.function.vectorize</code>.</p>
<h3 id="change-from-stickybar-to-bottombar"><a class="header" href="#change-from-stickybar-to-bottombar">Change from stickybar to bottombar</a></h3>
<p>For <code>nutils.cli.run</code> to draw a status bar, it now requires the external
<a href="https://github.com/evalf/bottombar">bottombar</a> module to be installed:</p>
<pre><code class="language-sh">python3 -m pip install --user bottombar
</code></pre>
<p>This replaces stickybar, which is no longer used. In addition to the log uri
and runtime the status bar will now show the current memory usage, if that
information is available. On Windows this requires <code>psutil</code> to be installed; on
Linux and OSX it should work by default.</p>
<h3 id="support-for-gmsh-msh4-file-format"><a class="header" href="#support-for-gmsh-msh4-file-format">Support for gmsh 'msh4' file format</a></h3>
<p>The <code>nutils.mesh.gmsh</code> method now supports input in the 'msh4' file format, in
addition to the 'msh2' format which remains supported for backward
compatibility. Internally, <code>nutils.mesh.parsegmsh</code> now takes file contents
instead of a file name.</p>
<h3 id="new-command-line-option-gracefulexit"><a class="header" href="#new-command-line-option-gracefulexit">New command line option: gracefulexit</a></h3>
<p>The new boolean command line option <code>gracefulexit</code> determines what happens when
an exception reaches <code>nutils.cli.run</code>. If true (default) then the exception is
handled as before and a system exit is initiated with an exit code of 2. If
false then the exception is reraised as-is. This is useful in particular when
combined with an external debugging tool.</p>
<h3 id="log-tracebacks-at-debug-level"><a class="header" href="#log-tracebacks-at-debug-level">Log tracebacks at debug level</a></h3>
<p>The way exceptions are handled by <code>nutils.cli.run</code> is changed from logging the
entire exception and traceback as a single error message, to logging the
exceptions as errors and tracebacks as debug messages. Additionally, the order
of exceptions and traceback is fully reversed, such that the most relevant
message is the first thing shown and context follows.</p>
<h3 id="solve-leniently-to-relative-tolerance-in-newton-systems"><a class="header" href="#solve-leniently-to-relative-tolerance-in-newton-systems">Solve leniently to relative tolerance in Newton systems</a></h3>
<p>The <code>nutils.solver.newton</code> method now sets the relative tolerance of the linear
system to <code>1e-3</code> unless otherwise specified via <code>linrtol</code>. This is mainly
useful for iterative solvers which can save computational effort by having
their stopping criterion follow the current Newton residual, but it may also
help with direct solvers to warn of ill conditioning issues. Iterations
furthermore use <code>nutils.matrix.Matrix.solve_leniently</code>, thus proceeding after
warning that tolerances have not been met in the hope that Newton convergence
might be attained regardless.</p>
<h3 id="linear-solver-arguments"><a class="header" href="#linear-solver-arguments">Linear solver arguments</a></h3>
<p>The methods <code>nutils.solver.newton</code>, <code>nutils.solver.minimize</code>,
<code>nutils.solver.pseudotime</code>, <code>nutils.solver.solve_linear</code> and
<code>nutils.solver.optimize</code> now receive linear solver arguments as keyword
arguments rather than via the <code>solveargs</code> dictionary, which is deprecated. To
avoid name clashes with the remaining arguments, argument names must be
prefixed by <code>lin</code>:</p>
<pre><code class="language-python">solver.solve_linear('lhs', res,
  solveargs=dict(solver='gmres')) # deprecated syntax

solver.solve_linear('lhs', res,
  linsolver='gmres') # new syntax
</code></pre>
<h3 id="iterative-refinement"><a class="header" href="#iterative-refinement">Iterative refinement</a></h3>
<p>Direct solvers enter an iterative refinement loop in case the first pass did
not meet the configured tolerance. In machine precision mode (atol=0, rtol=0)
this refinement continues until the residual stagnates.</p>
<h3 id="matrix-solver-tolerances"><a class="header" href="#matrix-solver-tolerances">Matrix solver tolerances</a></h3>
<p>The absolute and/or relative tolerance for solutions of a linear system can now
be specified in <code>nutils.matrix.Matrix.solve</code> via the <code>atol</code> resp. <code>rtol</code>
arguments, regardless of backend and solver. If the backend returns a solution
that violates both tolerances then an exception is raised of type
<code>nutils.matrix.ToleranceNotReached</code>, from which the solution can still be
obtained via the <code>.best</code> attribute. Alternatively the new method
<code>nutils.matrix.Matrix.solve_leniently</code> always returns a solution while logging
a warning if tolerances are not met. In case both tolerances are left at their
default value or zero then solvers are instructed to produce a solution to
machine precision, with subsequent checks disabled.</p>
<h3 id="use-stringly-for-command-line-parsing"><a class="header" href="#use-stringly-for-command-line-parsing">Use stringly for command line parsing</a></h3>
<p>Nutils now depends on stringly (version 1.0b1) for parsing of command line
arguments. The new implementation of <code>nutils.cli.run</code> is fully backwards
compatible, but the preferred method of annotating function arguments is now as
demonstrated in all of the examples.</p>
<p>For new Nutils installations Stringly will be installed automatically as a
dependency. For existing setups it can be installed manually as follows:</p>
<pre><code class="language-sh">python3 -m pip install --user --upgrade stringly
</code></pre>
<h3 id="fixed-and-fallback-lengths-in-namespace-expressions"><a class="header" href="#fixed-and-fallback-lengths-in-namespace-expressions">Fixed and fallback lengths in (namespace) expressions</a></h3>
<p>The <code>nutils.function.Namespace</code> has two new arguments: <code>length_&lt;indices&gt;</code> and
<code>fallback_length</code>. The former can be used to assign fixed lengths to specific
indices in expressions, say index <code>i</code> should have length 2, which is used for
verification and resolving undefined lengths. The latter is used to resolve
remaining undefined lengths:</p>
<pre><code class="language-python">ns = nutils.function.Namespace(length_i=2, fallback_length=3)
ns.eval_ij('δ_ij') # using length_i
# Array&lt;2,2&gt;
ns.eval_jk('δ_jk') # using fallback_length
# Array&lt;3,3&gt;
</code></pre>
<h3 id="treelog-update"><a class="header" href="#treelog-update">Treelog update</a></h3>
<p>Nutils now depends on treelog version 1.0b5, which brings improved iterators
along with other enhancements. For transitional convenience the backwards
incompatible changes have been backported in the <code>nutils.log</code> wrapper, which
now emits a warning in case the deprecated methods are used. This wrapper is
scheduled for deletion prior to the release of version 6.0. To update treelog
to the most recent version use:</p>
<pre><code class="language-sh">python -m pip install -U treelog
</code></pre>
<h3 id="unit-type"><a class="header" href="#unit-type">Unit type</a></h3>
<p>The new <code>nutils.types.unit</code> allows for the creation of a unit system for easy
specification of physical quantities. Used in conjunction with <code>nutils.cli.run</code>
this facilitates specifying units from the command line, as well as providing a
warning mechanism against incompatible units:</p>
<pre><code class="language-python">U = types.unit.create(m=1, s=1, g=1e-3, N='kg*m/s2', Pa='N/m2')
def main(length=U('2m'), F=U('5kN')):
  topo, geom = mesh.rectilinear([numpy.linspace(0,length,10)])
</code></pre>
<pre><code class="language-sh">python myscript.py length=25cm # OK
python myscript.py F=10Pa # error!
</code></pre>
<h3 id="sample-basis"><a class="header" href="#sample-basis">Sample basis</a></h3>
<p>Samples now provide a <code>nutils.sample.Sample.basis</code>: an array that for any point
in the sample evaluates to the unit vector corresponding to its index. This new
underpinning of <code>nutils.sample.Sample.asfunction</code> opens the way for sampled
arguments, as demonstrated in the last example below:</p>
<pre><code class="language-python">H1 = mysample.asfunction(mydata) # mysample.eval(H1) == mydata
H2 = mysample.basis().dot(mydata) # mysample.eval(H2) == mydata
ns.Hbasis = mysample.basis()
H3 = 'Hbasis_n ?d_n' @ ns # mysample.eval(H3, d=mydata) == mydata
</code></pre>
<h3 id="higher-order-gmsh-geometries"><a class="header" href="#higher-order-gmsh-geometries">Higher order gmsh geometries</a></h3>
<p>Gmsh element support has been extended to include cubic and quartic meshes in
2D and quadratic meshes in 3D, and parsing the msh file is now a cacheable
operation. Additionally, tetrahedra now define bezier points at any order.</p>
<h3 id="repository-location"><a class="header" href="#repository-location">Repository location</a></h3>
<p>The Nutils repository has moved to <a href="https://github.com/evalf/nutils.git">https://github.com/evalf/nutils.git</a>. For the
time being the old address is maintained by Github as an alias, but in the long
term you are advised to update your remote as follows:</p>
<pre><code class="language-sh">git remote set-url origin https://github.com/evalf/nutils.git
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-5-farfalle"><a class="header" href="#nutils-5-farfalle">Nutils 5 Farfalle</a></h1>
<p>Nutils 5 was released on April 3rd, 2020 and saw two point releases for fixes
and backports. The most recent and final version in this series is Nutils 5.2,
released on June 11th, 2019.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v5.2.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v5.2/">API Reference</a></li>
</ul>
<h2 id="whats-new-4"><a class="header" href="#whats-new-4">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-4.html">Nutils 4 Eliche</a>.</p>
<h3 id="matrix-matmul-operator-solve-with-multiple-right-hand-sides"><a class="header" href="#matrix-matmul-operator-solve-with-multiple-right-hand-sides">Matrix matmul operator, solve with multiple right hand sides</a></h3>
<p>The <code>Matrix.matvec</code> method has been deprecated in favour of the new
<code>__matmul__</code> (@) operator, which supports multiplication arrays of any
dimension. The <code>nutils.matrix.Matrix.solve</code> method has been extended to support
multiple right hand sides:</p>
<pre><code class="language-python">matrix.matvec(lhs) # deprecated
matrix @ lhs # new syntax
matrix @ numpy.stack([lhs1, lhs2, lhs3], axis=1)
matrix.solve(rhs)
matrix.solve(numpy.stack([rhs1, rhs2, rhs3], axis=1)
</code></pre>
<h3 id="mkls-fgmres-method"><a class="header" href="#mkls-fgmres-method">MKL's fgmres method</a></h3>
<p>Matrices produced by the <code>MKL</code> backend now support the
<code>nutils.matrix.Matrix.solve</code> argument solver='fmgres' to use Intel MKL's fgmres
method.</p>
<h3 id="thetamethod-time-target"><a class="header" href="#thetamethod-time-target">Thetamethod time target</a></h3>
<p>The <code>nutils.solver.thetamethod</code> class, as well as its special cases
<code>impliciteuler</code> and <code>cranknicolson</code>, now have a <code>timetarget</code> argument to
specify that the formulation contains a time variable:</p>
<pre><code class="language-python">res = topo.integral('...?t... d:x' @ ns, degree=2)
solver.impliciteuler('dofs', res, ..., timetarget='t')
</code></pre>
<h3 id="new-leveltopo-argument-for-trimming"><a class="header" href="#new-leveltopo-argument-for-trimming">New leveltopo argument for trimming</a></h3>
<p>In <code>nutils.topology.Topology.trim</code>, in case the levelset cannot be evaluated on
the to-be-trimmed topology itself, the correct topology can now be specified
via the new <code>leveltopo</code> argument.</p>
<h3 id="new-unittest-assertion-assertalmostequal64"><a class="header" href="#new-unittest-assertion-assertalmostequal64">New unittest assertion assertAlmostEqual64</a></h3>
<p><code>nutils.testing.TestCase</code> now facilitates comparison against base64 encoded,
compressed, and packed data via the new method
<code>nutils.testing.TestCase.assertAlmostEqual64</code>. This replaces
<code>numeric.assert_allclose64</code> which is now deprecated and scheduled for removal
in Nutils 6.</p>
<h3 id="fast-locate-for-structured-topology-geometry"><a class="header" href="#fast-locate-for-structured-topology-geometry">Fast locate for structured topology, geometry</a></h3>
<p>A special case <code>nutils.topology.Topology.locate</code> method for structured
topologies checks of the geometry is an affine transformation of the natural
configuration, in which case the trivial inversion is used instead of expensive
Newton iterations:</p>
<pre><code class="language-python">topo, geom = mesh.rectilinear([2, 3])
smp = topo.locate(geom/2-1, [[-.1,.2]])
# locate detected linear geometry: x = [-1. -1.] + [0.5 0.5] xi ~+2.2e-16
</code></pre>
<h3 id="lazy-references-transforms-bases"><a class="header" href="#lazy-references-transforms-bases">Lazy references, transforms, bases</a></h3>
<p>The introduction of sequence abstractions <code>nutils.elementseq</code> and
<code>nutils.transformseq</code>, together with and a lazy implementation of
<code>nutils.function.Basis</code> basis functions, help to prevent the unnecessary
generation of data. In hierarchically refined topologies, in particular, this
results in large speedups and a much reduced memory footprint.</p>
<h3 id="switch-to-treelog"><a class="header" href="#switch-to-treelog">Switch to treelog</a></h3>
<p>The <code>nutils.log</code> module is deprecated and will be replaced by the externally
maintained <code>treelog &lt;https://github.com/evalf/treelog&gt;</code>_, which is now an
installation dependency.</p>
<h3 id="replace-pariter-parmap-by-fork-range"><a class="header" href="#replace-pariter-parmap-by-fork-range">Replace pariter, parmap by fork, range.</a></h3>
<p>The <code>nutils.parallel</code> module is largely rewritten. The old methods <code>pariter</code>
and <code>parmap</code> are replaced by the <code>nutils.parallel.fork</code> context, combined with
the shared <code>nutils.parallel.range</code> iterator:</p>
<pre><code class="language-python">indices = parallel.range(10)
with parallel.fork(nprocs=2) as procid:
  for index in indices:
    print('procid={}, index={}'.format(procid, index))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-4-eliche"><a class="header" href="#nutils-4-eliche">Nutils 4 Eliche</a></h1>
<p>Nutils 4 was released on June 11th, 2019 and saw one point release for fixes
and backports. The most recent and final version in this series is Nutils 4.1
was released on August 28th, 2018.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v4.1.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v4.1/">API Reference</a></li>
</ul>
<h2 id="whats-new-5"><a class="header" href="#whats-new-5">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-3.html">Nutils 3 Dragon
Beard</a>.</p>
<h3 id="spline-basis-continuity-argument"><a class="header" href="#spline-basis-continuity-argument">Spline basis continuity argument</a></h3>
<p>In addition to the <code>knotmultiplicities</code> argument to define the
continuity of basis function on structured topologies, the
<code>nutils.topology.Topology.basis</code> method now supports the
<code>continuity</code> argument to define the global continuity of basis
functions. With negative numbers counting backwards from the
<code>degree</code>, the default value of <code>-1</code> corresponds to a knot
multiplicity of 1.</p>
<h3 id="eval-arguments"><a class="header" href="#eval-arguments">Eval arguments</a></h3>
<p>Functions of type <code>nutils.function.Evaluable</code> can receive
arguments in addition to element and points by depending on instances
of <code>nutils.function.Argument</code> and having their values specified
via <code>nutils.sample.Sample.eval</code>:</p>
<pre><code class="language-python">f = geom.dot(function.Argument('myarg', shape=geom.shape))
f = 'x_i ?myarg_i' @ ns # equivalent operation in namespace
topo.sample('uniform', 1).eval(f, myarg=numpy.ones(geom.shape))
</code></pre>
<h3 id="the-d-operator"><a class="header" href="#the-d-operator">The d:-operator</a></h3>
<p>Namespace expression syntax now includes the <code>d:</code> Jacobian operator,
allowing one to write <code>'d:x' @ ns</code> instead of <code>function.J(ns.x)</code>.
Since including the Jacobian in the integrand is preferred over
specifying it separately, the <code>geometry</code> argument of
<code>nutils.topology.Topology.integrate</code> is deprecated:</p>
<pre><code class="language-python">topo.integrate(ns.f, geometry=ns.x) # deprecated
topo.integrate(ns.f * function.J(ns.x)) # was and remains valid
topo.integrate('f d:x' @ ns) # new namespace syntax
</code></pre>
<h3 id="truncated-hierarchical-bsplines"><a class="header" href="#truncated-hierarchical-bsplines">Truncated hierarchical bsplines</a></h3>
<p>Hierarchically refined topologies now support basis truncation, which
reduces the supports of individual basis functions while maintaining
the spanned space. To select between truncated and non-truncated the
basis type must be prefixed with 'th-' or 'h-', respectively. A
non-prefixed basis type falls back on the default implementation that
fails on all types but discont:</p>
<pre><code class="language-python">htopo.basis('spline', degree=2) # no longer valid
htopo.basis('h-spline', degree=2) # new syntax for original basis
htopo.basis('th-spline', degree=2) # new syntax for truncated basis
htopo.basis('discont', degree=2) # still valid
</code></pre>
<h3 id="transparent-function-cache"><a class="header" href="#transparent-function-cache">Transparent function cache</a></h3>
<p>The <code>nutils.cache</code> module provides a memoizing function decorator
<code>nutils.cache.function</code> which reads return values from cache in
case a set of function arguments has been seen before. It is similar
in function to Python's <code>functools.lru_cache</code>, except that the cache
is maintained on disk and <code>nutils.types.nutils_hash</code> is used to
compare arguments, which means that arguments need not be Python
hashable. The mechanism is activated via <code>nutils.cache.enable</code>:</p>
<pre><code class="language-python">@cache.function
def f(x):
  return x * 2

with cache.enable():
  f(10)
</code></pre>
<p>If <code>nutils.cli.run</code> is used then the cache can also be enabled
via the new <code>--cache</code> command line argument. With many internal
Nutils functions already decorated, including all methods in the
<code>nutils.solver</code> module, transparent caching is available out of
the box with no further action required.</p>
<h3 id="new-module-types"><a class="header" href="#new-module-types">New module: types</a></h3>
<p>The new <code>nutils.types</code> module unifies and extends components
relating to object types. The following preexisting objects have been
moved to the new location:</p>
<ul>
<li><code>util.enforcetypes</code> → <code>types.apply_annotations</code></li>
<li><code>util.frozendict</code> → <code>types.frozendict</code></li>
<li><code>numeric.const</code> → <code>types.frozenarray</code></li>
</ul>
<h3 id="mkl-matrix-pardiso-solver"><a class="header" href="#mkl-matrix-pardiso-solver">MKL matrix, Pardiso solver</a></h3>
<p>The new <code>MKL</code> backend generates matrices that are powered by Intel's Math
Kernel Library, which notably includes the reputable Pardiso solver. This
requires <code>libmkl</code> to be installed, which is conveniently available through
pip:</p>
<pre><code class="language-sh">pip install mkl
</code></pre>
<p>When <code>nutils.cli.run</code> is used the new matrix type is selected
automatically if it is available, or manually using <code>--matrix=MKL</code>.</p>
<h3 id="nonlinear-minimization"><a class="header" href="#nonlinear-minimization">Nonlinear minimization</a></h3>
<p>For problems that adhere to an energy structure, the new solver method
<code>nutils.solver.minimize</code> provides an alternative mechanism that
exploits this structure to robustly find the energy minimum:</p>
<pre><code class="language-python">res = sqr.derivative('dofs')
solver.newton('dofs', res, ...)
solver.minimize('dofs', sqr, ...) # equivalent
</code></pre>
<h3 id="data-packing"><a class="header" href="#data-packing">Data packing</a></h3>
<p>Two new methods, <code>nutils.numeric.pack</code> and its inverse
<code>nutils.numeric.unpack</code>, provide lossy compression to floating
point data. Primarily useful for regression tests, the convenience
method <code>numeric.assert_allclose64</code> combines data packing with zlib
compression and base64 encoding for inclusion in Python codes.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-3-dragon-beard"><a class="header" href="#nutils-3-dragon-beard">Nutils 3 Dragon Beard</a></h1>
<p>Nutils 3 was released on August 22nd, 2018 and saw one point release for fixes
and backports. The most recent and final version in this series is Nutils 3.1,
released on February 5th, 2018.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v3.1.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v3.1/">API Reference</a></li>
</ul>
<h2 id="whats-new-6"><a class="header" href="#whats-new-6">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-2.html">Nutils 2 Chuka
Men</a>.</p>
<h3 id="new-functionnamespace"><a class="header" href="#new-functionnamespace">New: function.Namespace</a></h3>
<p>The <code>nutils.function.Namespace</code> object represents a container of
<code>nutils.function.Array</code> instances:</p>
<pre><code class="language-python">ns = function.Namespace()
ns.x = geom
ns.basis = domain.basis('std', degree=1).vector(2)
</code></pre>
<p>In addition to bundling arrays, arrays can be manipulated using index notation
via string expressions using the <code>nutils.expression</code> syntax:</p>
<pre><code class="language-python">ns.sol_i = 'basis_ni ?dofs_n'
f = ns.eval_i('sol_i,j n_j')
</code></pre>
<h3 id="new-topologyintegral"><a class="header" href="#new-topologyintegral">New: Topology.integral</a></h3>
<p>Analogous to <code>nutils.topology.Topology.integrate</code>, which integrates a function
and returns the result as a (sparse) array, the new method
<code>nutils.topology.Topology.integral</code> with identical arguments results in an
<code>nutils.sample.Integral</code> object for postponed evaluation:</p>
<pre><code class="language-python">x = domain.integrate(f, geometry=geom, degree=2) # direct
integ = domain.integral(f, geometry=geom, degree=2) # indirect
x = integ.eval()
</code></pre>
<p>Integral objects support linear transformations, derivatives and substitutions.
Their main use is in combination with routines from the <code>nutils.solver</code> module.</p>
<h3 id="removed-transformchain-canonicaltransformchain"><a class="header" href="#removed-transformchain-canonicaltransformchain">Removed: TransformChain, CanonicalTransformChain</a></h3>
<p>Transformation chains (sequences of transform items) are stored as standard
tuples. Former class methods are replaced by module methods:</p>
<pre><code class="language-python">elem.transform.promote(ndims) # no longer valid
transform.promote(elem.transform, ndims) # new syntax
</code></pre>
<p>In addition, every <code>edge_transform</code> and <code>child_transform</code> of Reference objects
is changed from (typically unit-length) <code>TransformChain</code> to
<code>nutils.transform.TransformItem</code>.</p>
<h3 id="changed-command-line-interface"><a class="header" href="#changed-command-line-interface">Changed: command line interface</a></h3>
<p>Command line parsers <code>nutils.cli.run</code> or <code>nutils.cli.choose</code> dropped support
for space separated arguments (--arg value), requiring argument and value to be
joined by an equals sign instead:</p>
<pre><code class="language-sh">python script.py --arg=value
</code></pre>
<p>Boolean arguments are specified by omitting the value and prepending 'no' to
the argument name for negation:</p>
<pre><code class="language-sh">python script.py --pdb --norichoutput
</code></pre>
<p>For convenience, leading dashes have been made optional:</p>
<pre><code class="language-sh">python script.py arg=value pdb norichoutput
</code></pre>
<h3 id="new-topology-intersections-deprecates-common_refinement"><a class="header" href="#new-topology-intersections-deprecates-common_refinement">New: Topology intersections (deprecates common_refinement)</a></h3>
<p>Intersections between topologies can be made using the <code>&amp;</code> operator. In case
the operands have different refinement patterns, the resulting topology will
consist of the common refinements of the intersection:</p>
<pre><code class="language-python">intersection = topoA &amp; topoB
interface = topo['fluid'].boundary &amp; ~topo['solid'].boundary
</code></pre>
<h3 id="changed-topologyindicator"><a class="header" href="#changed-topologyindicator">Changed: Topology.indicator</a></h3>
<p>The <code>nutils.topology.Topology.indicator</code> method is moved from subtopology to
parent topology, i.e. the topology you want to evaluate the indicator on, and
now takes the subtopology is an argument:</p>
<blockquote>
<blockquote>
<blockquote>
<p>ind = domain.boundary['top'].indicator() # no longer valid
ind = domain.boundary.indicator(domain.boundary['top']) # new syntax
ind = domain.boundary.indicator('top') # equivalent shorthand</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="changed-evaluableeval"><a class="header" href="#changed-evaluableeval">Changed: Evaluable.eval</a></h3>
<p>The <code>nutils.function.Evaluable.eval</code> method accepts a flexible number of
keyword arguments, which are accessible to <code>evalf</code> by depending on the
<code>EVALARGS</code> token. Standard keywords are <code>_transforms</code> for transformation
chains, <code>_points</code> for integration points, and <code>_cache</code> for the cache object:</p>
<pre><code class="language-python">f.eval(elem, 'gauss2') # no longer valid
ip, iw = elem.getischeme('gauss2')
tr = elem.transform, elem.opposite
f.eval(_transforms=tr, _points=ip) # new syntax
</code></pre>
<h3 id="new-numericconst"><a class="header" href="#new-numericconst">New: numeric.const</a></h3>
<p>The <code>numeric.const</code> array represents an immutable, hashable array:</p>
<pre><code class="language-python">A = numeric.const([[1,2],[3,4]])
d = {A: 1}
</code></pre>
<p>Existing arrays can be wrapped into a <code>const</code> object by adding <code>copy=False</code>.
The <code>writeable</code> flag of the original array is set to False to prevent
subsequent modification:</p>
<pre><code class="language-python">A = numpy.array([1,2,3])
Aconst = numeric.const(A, copy=False)
A[1] = 4
# ValueError: assignment destination is read-only
</code></pre>
<h3 id="new-function-annotations"><a class="header" href="#new-function-annotations">New: function annotations</a></h3>
<p>The <code>util.enforcetypes</code> decorator applies conversion methods to annotated
arguments:</p>
<pre><code class="language-python">@util.enforcetypes
def f(a:float, b:tuple)
  print(type(a), type(b))
f(1, [2])
# &lt;class 'float'&gt; &lt;class 'tuple'&gt;
</code></pre>
<p>The decorator is by default active to constructors of cache.Immutable
derived objects, such as function.Evaluable.</p>
<h3 id="changed-evaluable_edit"><a class="header" href="#changed-evaluable_edit">Changed: Evaluable._edit</a></h3>
<p>Evaluable objects have a default edit implementation that re-instantiates the
object with the operand applied to all constructor arguments. In situations
where the default implementation is not sufficient it can be overridden by
implementing the <code>edit</code> method (note: without the underscore):</p>
<pre><code class="language-python">class B(function.Evaluable):
  def __init__(self, d):
    assert isinstance(d, dict)
    self.d = d
  def edit(self, op):
    return B({key: op(value) for key, value in self.d.items()})
</code></pre>
<h3 id="changed-function-derivatives"><a class="header" href="#changed-function-derivatives">Changed: function derivatives</a></h3>
<p>The <code>nutils.function.derivative</code> <code>axes</code> argument has been removed;
<code>derivative(func, var)</code> now takes the derivative of <code>func</code> to all the axes in
<code>var</code>:</p>
<pre><code class="language-python">der = function.derivative(func, var,
        axes=numpy.arange(var.ndim)) # no longer valid
der = function.derivative(func, var) # new syntax
</code></pre>
<h3 id="new-module-cli"><a class="header" href="#new-module-cli">New module: cli</a></h3>
<p>The <code>nutils.util.run</code> function is deprecated and replaced by two new functions,
<code>nutils.cli.choose</code> and <code>nutils.cli.run</code>. The new functions are very similar to
the original, but have a few notable differences:</p>
<ul>
<li><code>cli.choose</code> requires the name of the function to be executed (typically
'main'), followed by any optional arguments</li>
<li><code>cli.run</code> does not require the name of the function to be executed, but only
a single one can be specified</li>
<li>argument conversions follow the type of the argument's default value, instead
of the result of <code>eval</code></li>
<li>the <code>--tbexplore</code> option for post-mortem debugging is replaced by <code>--pdb</code>,
replacing Nutils' own traceback explorer by Python's builtin debugger</li>
<li>on-line debugging is provided via the ctrl+c signal handler</li>
<li>function annotations can be used to describe arguments in both help messages
and logging output (see examples)</li>
</ul>
<h3 id="new-module-solver"><a class="header" href="#new-module-solver">New module: solver</a></h3>
<p>The <code>nutils.solver</code> module provides infrastructure to facilitate formulating
and solving complicated nonlinear problems in a structured and largely
automated fashion.</p>
<h3 subdomain,boundary,interfaces,points="">New: topology.with</h3>
<p>Topologies have been made fully immutable, which means that the old setitem
operation is no longer supported. Instead, to add a subtopology to the domain,
its boundary, its interfaces, or points, any of the methods <code>withsubdomain</code>,
<code>withboundary</code>, <code>withinterfaces</code>, and <code>withpoints</code>, respectively, will return a
copy of the topology with the desired groups added:</p>
<pre><code class="language-python">topo.boundary['wall'] = topo.boundary['left,top'] # no longer valid
newtopo = topo.withboundary(wall=topo.boundary['left,top']) # new syntax
newtopo = topo.withboundary(wall='left,top') # equivalent shorthand
newtopo.boundary['wall'].integrate(...)
</code></pre>
<h3 id="new-circular-symmetry"><a class="header" href="#new-circular-symmetry">New: circular symmetry</a></h3>
<p>Any topology can be revolved using the new <code>nutils.topology.Topology.revolved</code>
method, which interprets the first geometry dimension as a radius and replaces
it by two new dimensions, shifting the remaining axes backward. In addition to
the modified topology and geometry, simplifying function is returned as the
third return value which replaces all occurrences of the revolution angle by
zero. This should only be used after all gradients have been computed:</p>
<pre><code class="language-python">rdomain, rgeom, simplify = domain.revolved(geom)
basis = rdomain.basis('spline', degree=2)
M = function.outer(basis.grad(rgeom)).sum(-1)
rdomain.integrate(M, geometry=rgeom, ischeme='gauss2', edit=simplify)
</code></pre>
<h3 id="renamed-meshgmesh-to-meshgmsh-added-support-for-periodicity"><a class="header" href="#renamed-meshgmesh-to-meshgmsh-added-support-for-periodicity">Renamed mesh.gmesh to mesh.gmsh; added support for periodicity</a></h3>
<p>The gmsh importer was unintentionally misnamed as gmesh; this has been fixed.
With that the old name is deprecated and will be removed in future. In
addition, support for the non-physical mesh format and externally supplied
boundary labels has been removed (see the unit test tests/mesh.py for examples
of valid .geo format). Support is added for periodicity and interface groups.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-2-chuka-men"><a class="header" href="#nutils-2-chuka-men">Nutils 2 Chuka Men</a></h1>
<p>Nutils 2 was released on February 18th, 2016 and saw no point releases.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v2.0.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v2.0/">API Reference</a></li>
</ul>
<h2 id="whats-new-7"><a class="header" href="#whats-new-7">What's New?</a></h2>
<p>These are the main additions and changes since <a href="release-1.html">Nutils 1 Bakmi</a>.</p>
<h3 id="changed-jump-sign"><a class="header" href="#changed-jump-sign">Changed: jump sign</a></h3>
<p>The jump operator has been changed according to the following definition:
<code>jump(f) = opposite(f) - f</code>. In words, it represents the value of the argument
from the side that the normal is pointing toward, minus the value from the side
that the normal is pointing away from. Compared to the old definition this
means the sign is flipped.</p>
<h3 id="changed-topology-objects"><a class="header" href="#changed-topology-objects">Changed: Topology objects</a></h3>
<p>The Topology base class no longer takes a list of elements in its constructor.
Instead, the <code>__iter__</code> method should be implemented by the derived class, as
well as <code>__len__</code> for the number of elements, and getelem(index) to access
individual elements. The 'elements' attribute is deprecated.</p>
<p>The <code>nutils.topology.StructuredTopology</code> object no longer accepts an array with
elements. Instead, an 'axes' argument is provided with information that allows
it to generate elements in the fly. The 'structure' attribute is deprecated. A
newly added <code>shape</code> tuple is now a documented attribute.</p>
<h3 id="changed-properties-dumpdir-outdir-outrootdir"><a class="header" href="#changed-properties-dumpdir-outdir-outrootdir">Changed: properties dumpdir, outdir, outrootdir</a></h3>
<p>Two global properties have been renamed as follows:</p>
<ul>
<li>dumpdir → outdir</li>
<li>outdir → outrootdir</li>
</ul>
<p>The <code>outrootdir</code> defaults to ~/public_html and can be redefined from the
command line or in the .nutilsrc configuration file. The outdir defaults to the
current directory and is redefined by <code>util.run</code>, nesting the name/date/time
subdirectory sequence under <code>outrootdir</code>.</p>
<h3 id="changed-sum-axis-argument"><a class="header" href="#changed-sum-axis-argument">Changed: sum axis argument</a></h3>
<p>The behaviour of <code>nutils.function.sum</code> is inconsistent with that of the Numpy
counterparts. In case no axes argument is specified, Numpy sums over all axes,
whereas Nutils sums over the last axis. To undo this mistake and transition to
Numpy's behaviour, calling sum without an axes argument is deprecated and will
be forbidden in Nutils 3.0. In Nutils 4.0 it will be reintroduced with the
corrected meaning.</p>
<h3 id="changed-strict-dimension-equality-in-functionouter"><a class="header" href="#changed-strict-dimension-equality-in-functionouter">Changed: strict dimension equality in function.outer</a></h3>
<p>The <code>nutils.function.outer</code> method allows arguments of different dimension by
left-padding the smallest prior to multiplication. There is no clear reason for
this generality and it hinders error checking. Therefore in future in
<code>function.outer(a, b)</code>, <code>a.ndim</code> must equal <code>b.ndim</code>. In a brief transition
period non-equality emits a warning.</p>
<h3 id="changed-evaluable-base-class"><a class="header" href="#changed-evaluable-base-class">Changed: Evaluable base class</a></h3>
<p>Relevant only for custom <code>nutils.function.Evaluable</code> objects, the <code>evalf</code>
method changes from constructor argument to instance/class method:</p>
<pre><code class="language-python">class MyEval( function.Evaluable):
  def __init__(self, ...):
    function.Evaluable(args=[...], shape=...)
  def evalf( self, ...):
    ...
</code></pre>
<p>Moreover, the <code>args</code> argument may only contain Evaluable objects. Static
information is to be passed through <code>self</code>.</p>
<h3 id="removed-_numeric-c-extension"><a class="header" href="#removed-_numeric-c-extension">Removed: _numeric C-extension</a></h3>
<p>At this point Nutils is pure Python. It is no longer necessary to run make to
compile extension modules. The numeric.py module remains unchanged.</p>
<h3 id="periodic-boundary-groups"><a class="header" href="#periodic-boundary-groups">Periodic boundary groups</a></h3>
<p>Touching elements of periodic domains are no longer part of the <code>boundary</code>
topology. It is still available as boundary of an appropriate non-periodic
subtopology:</p>
<pre><code class="language-python">domain.boundary['left'] # no longer valid
domain[:,:1].boundary['left'] # still valid
</code></pre>
<h3 id="new-module-transform"><a class="header" href="#new-module-transform">New module: transform</a></h3>
<p>The new <code>nutils.transform</code> module provides objects and operations relating to
affine coordinate transformations.</p>
<h3 id="traceback-explorer-disabled-by-default"><a class="header" href="#traceback-explorer-disabled-by-default">Traceback explorer disabled by default</a></h3>
<p>The new command line switch <code>--tbexplore</code> activates the traceback explorer on
program failure. To change the default behavior add <code>tbexplore=True</code> to your
.nutilsrc file.</p>
<h3 id="rich-output"><a class="header" href="#rich-output">Rich output</a></h3>
<p>The new command line switch <code>--richoutput</code> activates color and unicode output.
To change the default behavior add <code>richoutput=True</code> to your .nutilsrc file.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-1-bakmi"><a class="header" href="#nutils-1-bakmi">Nutils 1 Bakmi</a></h1>
<p>Nutils 1 was released on August 4th, 2014 and saw no point releases.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v1.0.zip">Download</a> (zip)</li>
<li><a href="https://docs.nutils.org/en/v1.0/">API Reference</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="nutils-0-anelli"><a class="header" href="#nutils-0-anelli">Nutils 0 Anelli</a></h1>
<p>Nutils 0 was released on October 28th, 2013 and saw no point releases.</p>
<ul>
<li><a href="https://github.com/evalf/nutils/archive/refs/tags/v0.0.zip">Download</a> (zip)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<p>The fastest way to build a new Nutils simulation is to borrow bits and pieces
from existing scripts. Aiming to facilitate this practice,
<a href="https://examples.nutils.org">examples.nutils.org</a> provides a gallery of
concise examples demonstrating different areas of physics and varying
computational techniques.</p>
<p>The examples are taken from both the Nutils
<a href="https://github.com/evalf/nutils/tree/main/examples">repository</a> and user
contributed repositories, and are tested regularly to confirm validity against
different versions of Nutils.</p>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>Users are encouraged to contribute (concise versions of) their simulations to
this collection of examples. In doing so, they help other users get up to
speed, they help the developers by adding to a large body of realistic codes to
test Nutils against, and, in doing so, they may even help themselves by
preventing future Nutils version from accidentally breaking their code.</p>
<p>Examples should resemble the <a href="https://github.com/evalf/nutils/tree/main/examples">official
examples</a> from the Nutils
repository. In particular, they:</p>
<ul>
<li>use <code>cli.run</code> to call main function;</li>
<li>have reasonable default parameters corresponding to a simulation that is relevant but not overly expensive;</li>
<li>do not make use of undocumented functions (typically prefixed with an underscore);</li>
<li>use the most recent version of the <a href="https://nutils.org/tutorial-namespace.html">namespace</a>, if applicable;</li>
<li>generate one or more images that visualize the solution of the simulation;</li>
<li>use <code>treelog</code> to communicate output (<code>info</code> or <code>user</code> for text, <code>infofile</code> or <code>userfile</code> for data);</li>
<li>conform to the <a href="https://peps.python.org/pep-0008/">PEP 8</a> coding style;</li>
<li>are concise enough to fit a single file.</li>
</ul>
<p>Examples are submitted by means of a pull request to the <a href="https://github.com/evalf/nutils-website">examples
repository</a>, which should add a yaml
file to the examples/user directory. The file should define the following
entries:</p>
<ul>
<li><em>name</em> — Title of the simulation.</li>
<li><em>authors</em> — List of author names.</li>
<li><em>description</em> — Markdown formatted description of the simulation.</li>
<li><em>repository</em> — URL of the Git repository that contains the script.</li>
<li><em>commit</em> — Commit hash.</li>
<li><em>script</em> — Path of the script.</li>
<li><em>images</em> — List of images that are selected as preview.</li>
<li><em>tags</em> — List of relevant tags.</li>
</ul>
<p>Once merged, the script becomes part of the automated testing suite which runs
it at regular intervals against the latest Nutils version. The code itself
remains hosted on the external git repository. In case new features merit
updates to the script, the developers may reach out with concrete suggestions
to keep the examples relevant.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="science"><a class="header" href="#science">Science</a></h1>
<p>Nutils has been used in scientific publications since its earliest releases,
such as <a href="http://dx.doi.org/10.1016/j.cma.2014.07.009">this 2015 analysis of a trabecular bone
fragment</a> by Verhoosel et al,
combining several of Nutils' strengths including the Finite Cell Method,
hierarchical refinement, and isogeometric analysis. One of its images was later
selected to feature as cover art for the <a href="https://www.wiley.com/en-us/Encyclopedia+of+Computational+Mechanics%2C+6+Volume+Set%2C+2nd+Edition-p-9781119003793">Encyclopedia of Computational
Mechanics</a>.</p>
<p><img src="encyclopedia.jpg" alt="Encyclopedia of Computational Mechanics, Volume 4: Solids and Structures Part 2" /></p>
<p>Nutils has since been used in a wide range of applications, pushing the
boundaries of computational techniques, studying physical phenomena, and
testing new models. The <a href="science-publications.html">publication overview</a> lists
an up to date selection of Nutils powered research. If you are using Nutils in
your own research, please consider <a href="publications-citing.html">citing Nutils</a> in
your publications.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="publications"><a class="header" href="#publications">Publications</a></h1>
<p>Below is a selection of mostly peer reviewed articles that use Nutils for
numerical experiments. In case your Nutils powered research is not listed here,
please send the DOI to <a href="mailto:info@nutils.org">info@nutils.org</a> or submit a
<a href="https://github.com/evalf/nutils-book">pull request</a> with the new entry.
Articles that <a href="science-citing.html">cite Nutils</a> will be picked up automatically.</p>
<h2 id="2025"><a class="header" href="#2025">2025</a></h2>
<ul>
<li><a href="https://doi.org/10.1016/j.anucene.2024.110837">Application of Backward Differential Formula and Anderson’s method for multigroup diffusion transient equation</a>
by A. Cherezov, A. Vasiliev and H. Ferroukhi,
January 2025.</li>
</ul>
<h2 id="2024"><a class="header" href="#2024">2024</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1016/j.anucene.2024.110575">Low precision preconditioning for solving neutron diffusion eigenvalue problem by finite element method</a>
by A. Cherezov, A. Vasiliev and H, Ferroukhi,
October 2024.</p>
</li>
<li>
<p><a href="https://doi.org/10.1007/s00366-024-01997-x">On the use of elliptic PDEs for the parameterisation of planar multipatch domains</a>
by J. Hinz and A. Buffa,
May 2024.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2024.116958">Echocardiogram-based ventricular isogeometric cardiac analysis using multi-patch fitted NURBS</a>
by R. Willems, L. Verberne, O. van der Sluis and C.V. Verhoosel,
May 2024.</p>
</li>
<li>
<p><a href="https://doi.org/10.1063/5.0199294">A light Darwin implementation of Maxwell’s equations to quantify resistive, inductive, and capacitive couplings in windings</a>
by S. Pourkeivannour, J.S.B. van Zwieten, K. Iwai and M. Curti,
March 2024.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cad.2023.103636">A Shape Derivative Approach to Domain Simplification</a>
by J. Hinz, O. Chanon, A. Arrigoni and A. Buffa,
February 2024.</p>
</li>
<li>
<p><a href="https://doi.org/10.1002/mawe.202300157">Using Bayesian optimization for warpage compensation in injection molding</a>
by S. Tillmann, M. Behr and S. Elgeti,
January 2024.</p>
</li>
</ul>
<h2 id="2023"><a class="header" href="#2023">2023</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2023.116354">Finite element and isogeometric stabilized methods for the advection-diffusion-reaction equation</a>
by K. Key, M.R.A. Abdelmalik, S. Elgeti, T.J.R. Hughes and F.A. Baidoo,
December 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1007/978-3-031-36942-1_14">Scan-Based Immersed Isogeometric Flow Analysis</a>
by C.V. Verhoosel, E.H. van Brummelen, S.C. Divi and F. de Prenter,
November 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1063/5.0152690">Current progress toward isogeometric modeling of the heart biophysics</a>
by M. Torre, S. Morganti, F.S. Pasqualini and A. Reali,
November 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.3390/j6040041">A Comparative Study of Finite Element Method and Hybrid Finite Element Method–Spectral Element Method Approaches Applied to Medium-Frequency Transformers with Foil Windings</a>
by S. Pourkeivannour, J.S.B. van Zwieten, L.A.J. Friedrich, M. Curti and E.A. Lomonova,
November 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1017/jfm.2023.611">Numerical investigation of the sharp-interface limit of the Navier–Stokes–Cahn–Hilliard equations</a>
by T.H.B. Demont, S.K.F. Stoter and E.H. van Brummelen,
September 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1007/s00466-023-02376-x">An isogeometric analysis framework for ventricular cardiac mechanics</a>
by R. Willems, K.L.P.M. Janssens, P.H.M. Bovendeerd, C.V. Verhoosel and O. van der Sluis,
August 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1109/TMAG.2023.3269904">Optimal Coil Design for Coreless Linear Motors Based on the Extended Stream-Function Method</a>
by B.J.A. Kuijpers, J.W. Jansen and E.A. Lomonova,
July 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2023.116074">Critical time-step size analysis and mass scaling by ghost-penalty for immersogeometric explicit dynamics</a>
by S.K.F. Stoter, S.C. Divi, E.H. van Brummelen, M.G. Larson, F. de Prenter and C.V. Verhoosel,
July 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2023.116055">Isogeometric mixed collocation of nearly-incompressible electromechanics in finite deformations for cardiac muscle simulations</a>
by M. Torre, S. Morganti, A. Nitti, M.D. de Tullio, F.S. Pasqualini and Alessandro Reali,
June 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1103/PhysRevLett.130.228201">Reversal of Solvent Migration in Poroelastic Folds</a>
by M.M. Flapper, A. Pandey, M.H. Essink, E.H. van Brummelen, S. Karpitschka and J.H. Snoeijer,
June 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2022.115856">Immersed isogeometric analysis based on a hybrid collocation/finite cell method</a>
by M. Torre, S. Morganti, F.S. Pasqualini, A. Düster and A. Reali,
February 2023.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.jmps.2022.105082">A thermodynamically consistent J-integral formulation for fluid-driven fracture propagation in poroelastic continua</a>
by E.A. Bergkamp, C.V. Verhoosel, J.J.C. Remmers and D.M.J. Smeulders,
January 2023.</p>
</li>
</ul>
<h2 id="2022"><a class="header" href="#2022">2022</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1098/rspa.2022.0132">Soft wetting with (a)symmetric Shuttleworth effect</a>
by C. Henkel, M.H. Essink, T. Hoang, G.J. van Zwieten, E.H. van Brummelen and U. Thiele,
August 2022.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2022.115162">Entropy bounds for the space–time discontinuous Galerkin finite element moment method applied to the BGK–Boltzmann equation</a>
by M.R.A. Abdelmalik, D.A.M. van der Woude and E.H.van Brummelen,
August 2022.</p>
</li>
<li>
<p><a href="https://doi.org/10.1093/jom/ufac015">Residual-based error estimation and adaptivity for stabilized immersed isogeometric analysis using truncated hierarchical B-splines</a>
by S.C. Divi, P.H. van Zuijlen, T. Hoang, F. de Prenter, F. Auricchio, A. Reali, E.H. van Brummelen and C.V. Verhoosel,
May 2022.</p>
</li>
<li>
<p><a href="https://doi.org/10.1002/nag.3365">Inverting elastic dislocations using the Weakly-enforced Slip Method</a>
by G.J. van Zwieten, E.H. van Brummelen and R.F. Hanssen,
April 2022.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.jcp.2022.110972">A dimensionally-reduced fracture flow model for poroelastic media with fluid entry resistance and fluid slip</a>
by E.A. Bergkamp, C.V. Verhoosel, J.J.C. Remmers and D.M.J. Smeulders,
April 2022.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2022.114782">An efficient isogeometric collocation approach to cardiac electrophysiology</a>
by M. Torre, S. Morganti, A. Nitti, M.D. de Tullio, F.S. Pasqualini and A. Reali,
April 2022.</p>
</li>
<li>
<p><a href="https://doi.org/10.12688/openreseurope.14445.1">preCICE v2: A sustainable and user-friendly coupling library</a>
by G. Chourdakis, K. Davis, B. Rodenberg, M. Schulte, F. Simonis, B. Uekermann, G. Abrams, H. Bungartz, L.C. Yau, I. Desai, K. Eder, R. Hertrich, F. Lindner, A. Rusch, D. Sashko, D. Schneider, A. Totounferoush, D. Volland, P. Vollmer and O.Z. Koseomur,
April 2022.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2022.114648">Topology-preserving scan-based immersed isogeometric analysis</a>
by S.C. Divi, C.V. Verhoosel, F. Auricchio, A. Reali and E.H. van Brummelen,
March 2022.</p>
</li>
</ul>
<h2 id="2021"><a class="header" href="#2021">2021</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1109/TMAG.2021.3059903">Anisotropic Congruency-Based Vector Hysteresis Model Applied to Non-Oriented Laminated Steels</a>
by R. Zeinali, D. Krop and E. Lomonova,
June 2021.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2021.113685">The role of PDE-based parameterization techniques in gradient-based IGA shape optimization applications</a>
by J. Hinz, A. Jaeschke, M. Möller and C. Vuik,
May 2021.</p>
</li>
<li>
<p><a href="https://doi.org/10.3390/mca26010023">Finite Element Analysis of Laminar Heat Transfer within an Axial-Flux Permanent Magnet Machine</a>
by R. Willems, L.A.J. Friedrich and C.V. Verhoosel,
February 2021.</p>
<p><a href="https://doi.org/10.3390/j4010002">Time- and Frequency-Domain Steady-State Solutions of Nonlinear Motional Eddy Currents Problems</a>
by L.A.J. Friedrich,
January 2021.</p>
</li>
</ul>
<h2 id="2020"><a class="header" href="#2020">2020</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1016/j.camwa.2020.03.026">Error-estimate-based adaptive integration for immersed isogeometric analysis</a>
by S.C. Divi, C.V. Verhoosel, F. Auricchio, A. Reali and E.H. van Brummelen,
December 2020.</p>
</li>
<li>
<p><a href="https://doi.org/10.1103/PhysRevX.10.031067">Singular Nature of the Elastocapillary Ridge</a>
by A. Pandey, B. Andreotti, S. Karpitschka, G.J. van Zwieten, E.H. van Brummelen and J.H. Snoeijer,
September 2020.</p>
</li>
<li>
<p><a href="https://doi.org/10.1002/nme.6443">Quasi-Newton waveform iteration for partitioned surface-coupled multiphysics applications</a>
by B. Rüth, B. Uekermann, M. Mehl, P. Birken, A. Monge and H.J. Bungartz,
June 2020.</p>
</li>
<li>
<p><a href="https://doi.org/10.1007/s10596-019-09931-7">A staggered finite element procedure for the coupled Stokes-Biot system with fluid entry resistance</a>
by E.A. Bergkamp, C.V. Verhoosel, J.J.C. Remmers and D.M.J Smeulders,
May 2020.</p>
</li>
<li>
<p><a href="https://doi.org/10.1007/978-3-030-30705-9_8">Entropy Stable Discontinuous Galerkin Finite Element Moment Methods for Compressible Fluid Dynamics</a>
by M.R.A. Abdelmalik and E.H. van Brummelen,
February 2020.</p>
</li>
<li>
<p><a href="https://doi.org/10.1088/1742-6596/1669/1/012032">Splipy: B-Spline and NURBS Modelling in Python</a>
by K.A. Johannessen and E. Fonn,
January 2020.</p>
</li>
</ul>
<h2 id="2019"><a class="header" href="#2019">2019</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1007/s00466-019-01796-y">Multigrid solvers for immersed finite element methods and immersed isogeometric analysis</a>
by F. de Prenter, C.V. Verhoosel, E.H. van Brummelen, J.A. Evans, C. Messe, J. Benzaken and K. Maute,
November 2019.</p>
</li>
<li>
<p><a href="https://doi.org/10.48550/arXiv.1910.12588">Isogeometric Analysis of the Gray-Scott Reaction-Diffusion Equations for Pattern Formation on Evolving Surfaces and Applications to Human Gyrification</a>
by J. Hinz, J. van Zwieten, M. Möller and F. Vermolen,
October 2019.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2019.01.030">Preconditioning immersed isogeometric finite element methods with application to flow problems</a>
by F. de Prenter, C.V. Verhoosel and E.H. van Brummelen,
May 2019.</p>
</li>
<li>
<p><a href="https://doi.org/10.3390/en12071271">Finite-Volume High-Fidelity Simulation Combined with Finite-Element-Based Reduced-Order Modeling of Incompressible Flow Problems</a>
by E. Fonn, T. Kvamsdal and A. Rasheed,
April 2019.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2018.10.015">Skeleton-stabilized immersogeometric analysis for incompressible viscous flow problems</a>
by T. Hoang, C.V. Verhoosel, C. Qin, F. Auricchio, A. Reali and E.H. van Brummelen,
February 2019.</p>
</li>
</ul>
<h2 id="2018"><a class="header" href="#2018">2018</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1016/j.cagd.2018.03.023">Elliptic grid generation techniques in the framework of isogeometric analysis applications</a>
by J. Hinz, M. Möller and C. Vuik,
October 2018.</p>
</li>
<li>
<p><a href="https://doi.org/10.1088/1757-899X/425/1/012030">Spline-Based Parameterization Techniques for Twin-Screw Machine Geometries</a>
by J. Hinz, M. Möller and C. Vuik,
September 2018.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2018.03.034">Skeleton-stabilized IsoGeometric Analysis: High-regularity interior-penalty methods for incompressible viscous flow problems</a>
by T. Hoang, C.V. Verhoosel, F. Auricchio, E.H. van Brummelen and A. Reali,
August 2018.</p>
</li>
<li>
<p><a href="https://doi.org/10.1007/s00226-018-1038-6">Fracture behaviour of historic and new oak wood</a>
by R.A. Luimes, A.S.J. Suiker, C.V. Verhoosel and H.L. Schellen,
July 2018.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.camwa.2018.03.032">A note on the stability parameter in Nitsche's method for unfitted boundary value problems</a>
by F. de Prenter, C. Lehrenfeld and A. Massing,
April 2018.</p>
</li>
</ul>
<h2 id="2017"><a class="header" href="#2017">2017</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2017.06.024">Error estimation and adaptive moment hierarchies for goal-oriented approximations of the Boltzmann equation</a>
by M.R.A. Abdelmalik and E.H. van Brummelen,
October 2017.</p>
</li>
<li>
<p><a href="https://doi.org/10.1007/s10596-017-9667-7">An MSSS-preconditioned matrix equation approach for the time-harmonic elastic wave equation at multiple frequencies</a>
by M. Baumann, R. Astudillo, Y. Qiu, E.Y.M. Ang, M.B. van Gijzen and R.E. Plessix,
June 2017.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2016.07.027">Mixed Isogeometric Finite Cell Methods for the Stokes problem</a>
by T. Hoang, C.V. Verhoosel, F. Auricchio, E.H. van Brummelen and A. Reali,
April 2017.</p>
</li>
</ul>
<h2 id="2016"><a class="header" href="#2016">2016</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1007/978-3-319-40827-9_35">Elasto-capillarity Simulations based on the Navier-Stokes-Cahn-Hilliard Equations</a>
by E.H. Van Brummelen, M. Shokrpour-Roudbari and G.J. Van Zwieten,
October 2016.</p>
</li>
<li>
<p><a href="https://doi.org/10.1016/j.finel.2015.12.005">A fracture-controlled path-following technique for phase-field modeling of brittle fracture</a>
by N. Singh, C.V. Verhoosel, R. de Borst and E.H. van Brummelen,
June 2016.</p>
</li>
<li>
<p><a href="http://dx.doi.org/10.1016/j.cma.2016.07.006">Condition number analysis and preconditioning of the finite cell method</a>
by F. de Prenter, C.V. Verhoosel, G.J. van Zwieten and E.H. van Brummelen,
January 2016.</p>
</li>
</ul>
<h2 id="2015"><a class="header" href="#2015">2015</a></h2>
<ul>
<li>
<p><a href="https://doi.org/10.1016/j.cma.2014.11.019">Duality-based two-level error estimation for time-dependent PDEs: Application to linear and nonlinear parabolic equations</a>
by G. Şimşek, X. Wu, K.G. van der Zee and E.H. van Brummelen,
May 2015.</p>
</li>
<li>
<p><a href="http://doi.org/10.1002/nme.4952">On the use of adaptive refinement in isogeometric digitalimage correlation</a>
S.M. Kleinendorst, J.P.M. Hoefnagels, C.V. Verhoosel and A.P. Ruybalid,
May 2015.</p>
</li>
<li>
<p><a href="http://dx.doi.org/10.1016/j.cma.2014.07.009">Image-based goal-oriented adaptive isogeometric analysis with application to the micro-mechanical modeling of trabecular bone</a>
by C.V. Verhoosel, G.J. van Zwietena, B. van Rietbergen and R. de Borst,
February 2015.</p>
</li>
<li>
<p><a href="http://dx.doi.org/10.1016/j.cma.2014.09.037">A finite-element/boundary-element method for three-dimensional, large-displacement fluid–structure-interaction</a>
by T.M. van Opstal, E.H. van Brummelen and G.J. van Zwieten,
February 2015.</p>
</li>
</ul>
<h2 id="2014"><a class="header" href="#2014">2014</a></h2>
<ul>
<li><a href="http://dx.doi.org/10.1016/j.cma.2013.12.004">Discontinuities without discontinuity: The Weakly-enforced Slip Method</a>
by G.J. van Zwietena, E.H. van Brummelen, K.G. van der Zee, M.A. Gutiérrez and R.F. Hanssen,
April 2014.</li>
</ul>
<h2 id="2013"><a class="header" href="#2013">2013</a></h2>
<ul>
<li>
<p><a href="http://dx.doi.org/10.1002/cnm.2597">Stabilized second-order convex splitting schemes for Cahn–Hilliard models with application to diffuse-interface tumor-growth models</a>
by X. Wu, G.J. van Zwieten and K.G. van der Zee,
September 2013.</p>
</li>
<li>
<p><a href="http://www.tue.nl/fileadmin/content/faculteiten/wtb/Onderzoek/Onderzoeksgroepen/multiscale-engineering-fluid-dynamics/wu_vanZwieten_vanderZee_2013.pdf">Adaptive Time-Stepping for Cahn-Hilliard-type Equations with Application to Diffuse-Interface Tumor-growth Models (pdf)</a>
by X. Wu, G.J. Van Zwieten, K.G. van der Zee and G. Simsek,
March 2013.</p>
</li>
<li>
<p><a href="http://dx.doi.org/10.1007/978-94-007-6143-8_5">Shape-Newton Method for Isogeometric Discretizations of Free-Boundary Problems</a>
by K.G. van der Zee, G.J. van Zwieten, C.V. Verhoosel and E.H. van Brummelen,
February 2013.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="citing-nutils"><a class="header" href="#citing-nutils">Citing Nutils</a></h1>
<p>To acknowledge Nutils in publications, authors are encouraged to cite the
specific version of Nutils that was used to generate their results. To this
end, Nutils releases are assigned a Digital Object Identifier (DOI) by
<a href="https://zenodo.org/record/6006701">Zenodo</a> which can be used for citations.
For instance, a bibliography entry for Nutils 7.0 could look like this:</p>
<ul>
<li>J.S.B. van Zwieten, G.J. van Zwieten, W. Hoitinga. (2022). Nutils 7.0.
<em>Zenodo</em>. DOI <a href="https://doi.org/10.5281/zenodo.6006701">10.5281/zenodo.6006701</a>.</li>
</ul>
<p>For LaTeX documents, the corresponding bibtex entry would be:</p>
<pre><code class="language-bibtex">@misc{nutils7,
  title = {Nutils 7.0},
  author = {van Zwieten, J.S.B. and van Zwieten, G.J. and Hoitinga, W.},
  publisher = {Zenodo},
  year = {2022},
  doi = {10.5281/zenodo.6006701},
}
</code></pre>
<p>Note that Zenodo can additionally host and assign a DOI to code that is
specific to the publication, which is a great way to share digital artifacts
and ensure reproducibility of the research.</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="support"><a class="header" href="#support">Support</a></h1>
<p>For questions that are not answered by the <a href="tutorial.html">tutorial</a>, the API
reference for the relevant <a href="release.html">release</a>, or the
<a href="examples.html">examples</a>, there are a few avenues for getting additional
support.</p>
<p>Questions that lend themselves to be formulated in a concise and general way
can be made into a <a href="https://github.com/evalf/nutils/discussions/categories/q-a">Q&amp;A
topic</a>, where both
developers and advanced users can weigh in their answers, and where they may be
of benefit to others encountering the same issue. Be sure to check first if
your issue was not discussed already!</p>
<p>If you believe that you have spotted a bug, the best thing to do is to file an
<a href="https://github.com/evalf/nutils/issues">issue</a>. Issues should contain a
description of the problem, the expected behaviour, and steps to reproduce,
including the version of Nutils that the issue relates to. If you believe that
the bug was recently introduced you can help the developers by identifying the
first failing commit, for instance using
<a href="https://git-scm.com/docs/git-bisect">bisection</a>.</p>
<p>Finally, for general discussions, questions, suggestions, or just to say hello,
everybody is welcome to join the nutils-users support channel at
<a href="https://matrix.to/#/#nutils-users:matrix.org">#nutils-users:matrix.org</a>. Note
that you will need to create an account at any Matrix server in order to join
this channel.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
